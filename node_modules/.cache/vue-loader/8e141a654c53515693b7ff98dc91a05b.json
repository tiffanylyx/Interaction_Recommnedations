{"remainingRequest":"/Users/apple/Desktop/study/大四上/Vis/vue_practice/museum_vis/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/apple/Desktop/study/大四上/Vis/vue_practice/museum_vis/src/components/Map.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/apple/Desktop/study/大四上/Vis/vue_practice/museum_vis/src/components/Map.vue","mtime":1617179384171},{"path":"/Users/apple/Desktop/study/大四上/Vis/vue_practice/museum_vis/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/apple/Desktop/study/大四上/Vis/vue_practice/museum_vis/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/apple/Desktop/study/大四上/Vis/vue_practice/museum_vis/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/apple/Desktop/study/大四上/Vis/vue_practice/museum_vis/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCAqIGFzIGQzIGZyb20gImQzIjsKaW1wb3J0ICogYXMgdG9wb2pzb24gZnJvbSAidG9wb2pzb24iCmltcG9ydCAqIGFzIGQzQ2hyb21hdGljIGZyb20gJ2QzLXNjYWxlLWNocm9tYXRpYyc7Ci8vaW1wb3J0IFZ1ZSBmcm9tICd2dWUnOwppbXBvcnQgQnVzIGZyb20gJy4uL2Fzc2V0cy9idXMuanMnOwovL2ltcG9ydCAqIGFzIGQzVm9yb25vaSBmcm9tICdkMy12b3Jvbm9pJwovL3ZhciBtc2dDZW50ZXIgPSBuZXcgVnVlKCkKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJBcHAiLAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBwbGFjZV9jb2xvcjonJywKICAgICAgc2VsZWN0X2RhdGE6JycsCiAgICAgIEhpc3Rfc2VsZWN0X2RhdGE6JycsCiAgICAgIEZvcmNlX3NlbGVjdF9kYXRhOicnLAogICAgICBteUNpcmNsZTonJywKICAgICAgbXlMaW5rOicnLAogICAgICBzdmc6JycsCiAgICAgIGhvdmVyX3BlcmlvZDonJywKICAgICAgZzQ6JycsCiAgICAgIGczOicnLCAKICAgICAgZzI6JycsCiAgICAgIHpvb21fdmFsdWU6W10sCiAgICAgIGcxXzU6JycsCiAgICAgIHZlcnRpY2VzOicnLAogICAgICBncm91cDE6JycsCiAgICAgIGcxOicnLAogICAgICBwcm9qZWN0aW9uOicnLAogICAgICBwYXRoOicnLAogICAgICBkcm9wZG93bkJ1dHRvbjonJywKICAgICAgc3VidW5pdHM6JycsCiAgICAgIHBsYWNlczonJwogICAgfTsKICB9LAogIC8vY3JlYXRlZCgpIHsKICAgIC8vIOWcqOmcgOimgeeahOS8oOmAkuaVsOaNrueahOaXtuWAmeiwg+eUqHNlbmREYXRh5pa55rOV77yM6L+Z6YeM5qih5ouf6LCD55SoCiAgICAvL3RoaXMuc2VuZERhdGEoKTsKICAgIAogIC8vfSwKICBtb3VudGVkKCkgewogICAgdGhpcy5nZXRNYXAoKTsKICAgIHRoaXMuaGFuZGxlKCkKICAgIC8vdGhpcy5zZW5kRGF0YSgpOwogIH0sCiAgbWV0aG9kczogewogICAgaGFuZGxlOiBmdW5jdGlvbiAoKSB7CiAgICBCdXMuJG9uKCJzdWJ1bml0cyIsKCk9Pnt0aGlzLmdlbmVyYXRlQXJjKCl9KQogICAgQnVzLiRvbigiTmV3X1BvZXQiLCAodmFsKSA9PiB7CiAgICAgIHRoaXMudXBkYXRlKHZhbCl9KSwgIAogICAgQnVzLiRvbigiaG92ZXJfcGVyaW9kIiwgKHZhbCkgPT4gewogICAgICB0aGlzLmhvdmVyX3BlcmlvZD12YWw7CiAgICAgIHRoaXMuc2hvd19wZXJpb2QoKX0pLAogICAgQnVzLiRlbWl0KCJNYXBfYWdlIiwgdGhpcy5zZWxlY3RfdmFsdWUpLAogICAgQnVzLiRvbigiSGlzdF9zZWxlY3RfZGF0YSIsICh2YWwpID0+IHsKICAgICAgdGhpcy5IaXN0X3NlbGVjdF9kYXRhPXZhbDsKICAgICAgdGhpcy5zZWxlY3RfbmV3X3BvaW50KCl9KSwKICAgIEJ1cy4kb24oImNoYW5nZSIsICgpID0+IHsKICAgICAgdmFyIHRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKS8xMDAwCgogICAgICB0aGlzLkdMT0JBTC5WaXN1YWxfc3RhdGVbJ3RpbWVzdGFtcCddID0gdGltZQogICAgICB2YXIgc2F2ZSA9IEpTT04uc3RyaW5naWZ5KHRoaXMuR0xPQkFMLlZpc3VhbF9zdGF0ZSkKCiAgICAgIHRoaXMuR0xPQkFMLlZpc3VhbF9zdGF0ZV9BbGwucHVzaChbdGltZSxzYXZlXSkKICAgICAgdGhpcy5wb3N0VmlzdWFsKHsnbmFtZSc6dGhpcy5HTE9CQUwuVmlzdWFsX3N0YXRlfSl9KSwgIAogICAgQnVzLiRvbigiRm9yY2Vfc2VsZWN0X2RhdGEiLCAodmFsKSA9PiB7CiAgICAgIHRoaXMuRm9yY2Vfc2VsZWN0X2RhdGE9dmFsOwogICAgICB0aGlzLnNlbGVjdF9uZXdfcG9pbnRfRm9yY2UoKX0pCiAgICBCdXMuJG9uKCJHZXRfUHJlZGljdCIsKHZhbCkgPT4ge3RoaXMuR2V0X1ByZWRpY3QodmFsKX0pfSwKICAgIGdldE1hcCgpewogICAgICBsZXQgc2VsZiA9IHRoaXMKICAgICAgICBkMy5qc29uKCJzdXNoaV9tYXAuanNvbiIsIGZ1bmN0aW9uKGVycm9yLCBwb2ludCkgewogICAgICAgIHNlbGYuc3VidW5pdHMgPSB0b3BvanNvbi5mZWF0dXJlKHBvaW50LCBwb2ludC5vYmplY3RzLmNoaW5hKQogICAgICAgIEJ1cy4kZW1pdCgic3VidW5pdHMiLHNlbGYuc3VidW5pdHMpCn0pCiAgICB9LAogICAgZ2VuZXJhdGVBcmMoKSB7CiAgICAgIGNvbnN0IHdpZHRoID0gNTAwOwogICAgICBjb25zdCBoZWlnaHQgPSA2NDA7CgogICAgICBjb25zdCBwcm9qZWN0aW9uID0gZDMuZ2VvQWxiZXJzKCkKICAgICAgICAgIC5jZW50ZXIoWzIsIDI5LjZdKQogICAgICAgICAgLnJvdGF0ZShbLTExMCwgMF0pCiAgICAgICAgICAucGFyYWxsZWxzKFsyMCwgNjBdKQogICAgICAgICAgLnRyYW5zbGF0ZShbd2lkdGggLyAyLCBoZWlnaHQgLyAyXSkKICAgICAgICAgIC5zY2FsZSgxNjAwKQogICAgICB0aGlzLnByb2plY3Rpb24gPSBwcm9qZWN0aW9uCgogICAgICBjb25zdCBwYXRoID0gZDMuZ2VvUGF0aCgpCiAgICAgICAgICAucHJvamVjdGlvbihwcm9qZWN0aW9uKQogICAgICAgICAgLnBvaW50UmFkaXVzKDIpOwogICAgICB0aGlzLnBhdGggPSBwYXRoCiAgICAgIHZhciBkcm9wZG93bkJ1dHRvbiA9IGQzLnNlbGVjdCgiI3BvcyIpCiAgICAgIC5hcHBlbmQoJ3NlbGVjdCcpLmF0dHIoIngiLCIxMDBweCIpCiAgICAgIAogICAgICBjb25zdCBzdmcgPSBkMwogICAgICAgIC5zZWxlY3QoIiNtYXAiKQogICAgICAgIC5hcHBlbmQoInN2ZyIpCiAgICAgICAgLmF0dHIoIndpZHRoIiwgd2lkdGgpCiAgICAgICAgLmF0dHIoImhlaWdodCIsIGhlaWdodCk7CiAgICAgIGxldCBzZWxmID0gdGhpcwogICAgICBkMy5jc3YoInBsYWNlX3NlbnRpMi5jc3YiLGZ1bmN0aW9uKGRhdGFfYWxsKXsKICAgICAgICB2YXIgZGF0YSA9IHsnU3UgU2hpJzpbXSwnSHVhbmcgVGluZ2ppYW4nOltdLCdPdXlhbmcgWGl1JzpbXSwnWGluIFFpamknOltdfQogICAgICAgIGZvcih2YXIgaSBpbiBkYXRhX2FsbCl7CiAgICAgICAgICBpZihkYXRhX2FsbFtpXVsnYXV0aG9yJ109PSdTdSBTaGknKXsKICAgICAgICAgICAgZGF0YVsnU3UgU2hpJ10ucHVzaChkYXRhX2FsbFtpXSkKICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgaWYoZGF0YV9hbGxbaV1bJ2F1dGhvciddPT0nSHVhbmcgVGluZ2ppYW4nKXsKICAgICAgICAgICAgZGF0YVsnSHVhbmcgVGluZ2ppYW4nXS5wdXNoKGRhdGFfYWxsW2ldKQogICAgICAgICAgfQogICAgICAgICAgZWxzZSBpZihkYXRhX2FsbFtpXVsnYXV0aG9yJ109PSdPdXlhbmcgWGl1Jyl7CiAgICAgICAgICAgIGRhdGFbJ091eWFuZyBYaXUnXS5wdXNoKGRhdGFfYWxsW2ldKQogICAgICAgICAgfQogICAgICAgICAgZWxzZSBpZihkYXRhX2FsbFtpXVsnYXV0aG9yJ109PSdYaW4gUWlqaScpewogICAgICAgICAgICBkYXRhWydYaW4gUWlqaSddLnB1c2goZGF0YV9hbGxbaV0pCiAgICAgICAgICB9ICAgICAgICAgIAogICAgICAgIH0KICAgICAgICBzZWxmLnBsYWNlX2NvbG9yID0gZGF0YQogICAgICAgIHNlbGYucGxhY2VfY29sb3Jfc2VsZWN0ID0gZGF0YVsnU3UgU2hpJ10KICAgICAgfSkKICAgICAgZDMuanNvbigibWFwLmpzb24iLCBmdW5jdGlvbihlcnJvciwgcG9pbnQpIHsKICAgICAgdmFyIHN1YnVuaXRzID0gc2VsZi5zdWJ1bml0cwogICAgICB2YXIgcGxhY2VzX2FsbCA9IHRvcG9qc29uLmZlYXR1cmUocG9pbnQsIHBvaW50Lm9iamVjdHMucGxhY2VzKQogICAgICB2YXIgcGxhY2VzMSA9IFtdCiAgICAgIGZvcihpIGluIHBsYWNlc19hbGxbJ2ZlYXR1cmVzJ10pewogICAgICAgIGlmKHBsYWNlc19hbGxbJ2ZlYXR1cmVzJ11baV0ucHJvcGVydGllcy5hdXRob3I9PSdTdSBTaGknKXsKICAgICAgICAgIHBsYWNlczEucHVzaChwbGFjZXNfYWxsWydmZWF0dXJlcyddW2ldKQogICAgICAgIH0KICAgICAgfQogICAgICB2YXIgcGxhY2VzID0ge3R5cGU6ICJGZWF0dXJlQ29sbGVjdGlvbiIsZmVhdHVyZXM6cGxhY2VzMX0KICAgICAgc2VsZi5wbGFjZXMgPSBwbGFjZXMKICAgICAgc2VsZi5HTE9CQUwucGxhY2Vfbm93ID0gcGxhY2VzCiAgICAgIEJ1cy4kZW1pdCgnU3RhcnRfUGxhY2UnLCBwbGFjZXMpCiAgdmFyIG15Q29sb3IgPSBkMy5zY2FsZVNlcXVlbnRpYWwoKQogICAgLmRvbWFpbihbMC44MywwLjQyXSkKICAgIC5pbnRlcnBvbGF0b3IoZDNDaHJvbWF0aWMuaW50ZXJwb2xhdGVQaVlHKTsKICBmdW5jdGlvbiBjaG9vc2VfY29sb3IocGxhY2UpewogICAgdmFyIG5hbWUgPSBwbGFjZS5wcm9wZXJ0aWVzLm5hbWUKICAgIHZhciByZXMgPSAicmdiKDEwMCwxNDksMjM3KSIKICAgIGZvciAodmFyIGkgPSAwO2k8c2VsZi5wbGFjZV9jb2xvcl9zZWxlY3QubGVuZ3RoOyBpKyspIHsKICAgICAgdmFyIHNsaSA9IHNlbGYucGxhY2VfY29sb3Jfc2VsZWN0W2ldCiAgICAgIGlmKG5hbWUgPT0gc2xpWydwbGFjZSddKXsKICAgICAgICByZXMgPSBteUNvbG9yKHNsaVsnc2VudGknXSkKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlcwogIH0KCiAgdmFyIHpvb20gPSBkMy56b29tKCkKICAgICAgLnNjYWxlRXh0ZW50KFswLjUsM10pLy/nlKjkuo7orr7nva7mnIDlsI/lkozmnIDlpKfnmoTnvKnmlL7mr5TkvosKICAgICAgLm9uKCJ6b29tIix6b29tZWQpIAovKgpzZWxmLkdMT0JBTC5OZXdfdGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpLzEwMDAKc2VsZi5HTE9CQUwuT2xkX3RpbWUgPSBzZWxmLkdMT0JBTC5OZXdfdGltZQpzZWxmLkdMT0JBTC5Mb2dfZmlsZS5wdXNoKFsnU3RhcnRfdGltZXN0YW1wJyxzZWxmLkdMT0JBTC5OZXdfdGltZSwnXG4nXSkKc2VsZi5wb3N0SW50ZXJhY3Rpb24oeyduYW1lJzpzZWxmLkdMT0JBTC5Mb2dfZmlsZX0pKi8KLy/nvJblhpkg5bmz56e75Ye95pWwCi8qCmZ1bmN0aW9uIHJlc2V0KCkgewogICAgCiAgICAgIHN2Zy50cmFuc2l0aW9uKCkuZHVyYXRpb24oNzUwKS5jYWxsKCAvL2R1cmF0aW9u6L+H5rih5pe26Ze0CiAgICAgICAgem9vbS50cmFuc2Zvcm0sCiAgICAgICAgZDMuem9vbUlkZW50aXR5LCAvL+aOp+WItue8qeaUvuS4reW/g+eahOS4uum8oOagh+W9k+WJjeS9jee9rgogICAgICAgIGQzLnpvb21UcmFuc2Zvcm0oc3ZnLm5vZGUoKSkuaW52ZXJ0KFt3aWR0aCAvIDIsIGhlaWdodCAvIDJdKSAvL+W8ueaAp+WKqOeUu+eahOWchuW/g+S9jee9rgogICAgICApOwp9Ki8KLy8g57yp5pS+5Ye95pWwCgpmdW5jdGlvbiB6b29tZWQoKSB7CiAgICBjb25zdCB0cmFuc2Zvcm0gPSBkMy5ldmVudC50cmFuc2Zvcm07IC8v6K+G5Yir6byg5qCH5LqL5Lu2CiAgICBzZWxmLkdMT0JBTC5OZXdfdGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpLzEwMDAKICAgICAgc2VsZi56b29tX3ZhbHVlLnB1c2goWyd0aW1lc3RhbXAnLG5ldyBEYXRlKCkuZ2V0VGltZSgpLzEwMDAsJ1pvb20tTWFwLVZhbHVlJyx0cmFuc2Zvcm0sJ1xuJ10pCiAgICBzZWxmLkdMT0JBTC5PbGRfdGltZSA9IHNlbGYuR0xPQkFMLk5ld190aW1lCiAgICAKICAgIGdyb3VwMS5hdHRyKCJ0cmFuc2Zvcm0iLCB0cmFuc2Zvcm0pOyAvL+Wwhue8qeaUvue7k+aenOS8oOe7mWcKICAgIHZhciBrID0gTWF0aC5zcXJ0KDEwMCAvIHByb2plY3Rpb24uc2NhbGUoKSk7IC8v5L+u5pS55Zyw5Zu+5bC65a+4CiAgICBncm91cDEuYXR0cigic3Ryb2tlLXdpZHRoIiwgMSAvIGspOyAvL+S/ruaUueWvueW6lOeahOWxnuaApwogICAgcmV0dXJuIHRyYW5zZm9ybQp9CiAgICB2YXIgZ3JvdXAxID0gc3ZnLmFwcGVuZCgiZyIpLmF0dHIoImlkIiwiZ3JvdXAiKS5kYXR1bSh7CiAgICB4OiAwLAogICAgeTogMAogIH0pLy8ub24oImNsaWNrIiwgcmVzZXQpOyAgLy/lrprkuYnngrnlh7vkuovku7YKICAgICAgdmFyIGcxID0gZ3JvdXAxLmFwcGVuZCgiZyIpLmF0dHIoImlkIiwiZm9yX3BhdGgiKTsgCiAgICAgIC8vdmFyIGcwID0gZ3JvdXAuYXBwZW5kKCJnIikuYXR0cigiaWQiLCJmb3Jfdm8iKTsgLy/mlrDlop7nu4TvvIznlKjkuo7lrZjlgqjkuI3lkIzlr7nosaEKICAgICAgdmFyIGcxXzUgPSBncm91cDEuYXBwZW5kKCJnIikuYXR0cigiaWQiLCJmb3JfaW50ZXJhY3Rpb25fc3VnZ2VzdGlvbiIpOyAvLwogICAgICBzZWxmLmcxXzUgPSBnMV81CiAgICAgIHZhciBnMyA9IGdyb3VwMS5hcHBlbmQoImciKS5hdHRyKCJpZCIsImZvcl9saW5lIikuYXR0cigicG9pbnRlci1ldmVudHMiLCJub25lIik7CiAgICAgIHZhciBnMiA9IGdyb3VwMS5hcHBlbmQoImciKS5hdHRyKCJpZCIsImZvcl9jaXJjbGUiKTsKc2VsZi5nMiA9IGcyCnNlbGYuZzMgPSBnMwovLyAKCgpnMS5zZWxlY3RBbGwoIi5zdWJ1bml0IikKICAgICAgLmRhdGEoc3VidW5pdHMuZmVhdHVyZXMpCiAgICAuZW50ZXIoKS5hcHBlbmQoInBhdGgiKQogICAgICAuYXR0cigiY2xhc3MiLCBmdW5jdGlvbihkKSB7IHJldHVybiAic3VidW5pdCAiICsgZC5pZDsgfSkKICAgICAgLmF0dHIoImQiLCBwYXRoKQogICAgICAuYXR0cignc3Ryb2tlJywnIzIyMicpCiAgICAgIC5hdHRyKCdzdHJva2Utd2lkdGgnLCcxcHgnKQogICAgICAuYXR0cignZmlsbCcsZnVuY3Rpb24oZCl7dmFyIHAgPSBkLnByb3BlcnRpZXMubmFtZQogICAgICAgIGlmKChwPT0n5bGx6KW/55yBJyl8KHA9PSfpmZXopb/nnIEnKXwocD09J+ays+WNl+ecgScpfChwPT0n5rKz5YyX55yBJyl8KHA9PSfljJfkuqzluIInKXwKICAgICAgICAgIChwPT0n5aSp5rSl5biCJyl8KHA9PSfmsrPljZfnnIEnKXwocD09J+WxseS4nOecgScpfChwPT0n5rGf6IuP55yBJyl8KHA9PSfmtZnmsZ/nnIEnKXwKICAgICAgICAgIChwPT0n5LiK5rW35biCJyl8KHA9PSfmuZbljZfnnIEnKXwocD09J+a5luWMl+ecgScpfChwPT0n5rGf6KW/55yBJyl8KHA9PSfph43luobluIInKXwKICAgICAgICAgIChwPT0n5Zub5bed55yBJyl8KHA9PSflub/opb/lo67ml4/oh6rmsrvljLonKXwocD09J+a1t+WNl+ecgScpfChwPT0n5bm/5Lic55yBJyl8KHA9PSfotLXlt57nnIEnKXwKICAgICAgICAgIChwPT0n56aP5bu655yBJyl8KHA9PSflronlvr3nnIEnKSl7cmV0dXJuICcjY2NjJ30KICAgICAgICBlbHNle3JldHVybiAnI2ZmZid9fSkKCnZhciBsaW5rMXMgPSBbCiAge3R5cGU6ICJMaW5lU3RyaW5nIiwgYWdlOjAsY29vcmRpbmF0ZXM6IFtbMCwwXSxbMCwwXV19Cl0KICAgIGZvcih2YXIgaT0wLCBsZW49cGxhY2VzLmZlYXR1cmVzLmxlbmd0aC0xOyBpPGxlbjsgaSsrKXsKICAgIC8vIChub3RlOiBsb29wIHVudGlsIGxlbmd0aCAtIDEgc2luY2Ugd2UncmUgZ2V0dGluZyB0aGUgbmV4dAogICAgLy8gIGl0ZW0gd2l0aCBpKzEpCiAgICAgICAgbGluazFzLnB1c2goewogICAgICAgICAgICB0eXBlOiAiTGluZVN0cmluZyIsCiAgICAgICAgICAgIGFnZSA6IHBsYWNlcy5mZWF0dXJlc1tpXS5wcm9wZXJ0aWVzLmFnZSwKICAgICAgICAgICAgY29vcmRpbmF0ZXM6IFsKICAgICAgICAgICAgICAgIFsgcGxhY2VzLmZlYXR1cmVzW2ldLmdlb21ldHJ5LmNvb3JkaW5hdGVzWzBdLCBwbGFjZXMuZmVhdHVyZXNbaV0uZ2VvbWV0cnkuY29vcmRpbmF0ZXNbMV1dLAogICAgICAgICAgICAgICAgWyBwbGFjZXMuZmVhdHVyZXNbaSsxXS5nZW9tZXRyeS5jb29yZGluYXRlc1swXSwgcGxhY2VzLmZlYXR1cmVzW2krMV0uZ2VvbWV0cnkuY29vcmRpbmF0ZXNbMV1dXQogICAgICAgIH0pOwogICAgfQogICAgZzMuYXBwZW5kKCdzdmc6ZGVmcycpLmFwcGVuZCgnc3ZnOm1hcmtlcicpCiAgICAgICAgLmF0dHIoJ2lkJywgJ2VuZC1hcnJvdycpCiAgICAgICAgLmF0dHIoJ3ZpZXdCb3gnLCAnMCAtNSA4IDgnKQogICAgICAgIC5hdHRyKCdyZWZYJywgNSkKICAgICAgICAuYXR0cignbWFya2VyV2lkdGgnLCAyLjUpLy/nrq3lpLTlj4LmlbDpgILlvZPmjInpnIDosIPmlbQKICAgICAgICAuYXR0cignbWFya2VySGVpZ2h0JywgMi41KQogICAgICAgIC5hdHRyKCdvcmllbnQnLCAnYXV0bycpCiAgICAgICAgLmFwcGVuZCgnc3ZnOnBhdGgnKQogICAgICAgIC5hdHRyKCdkJywgJ00wLC01TDEwLDBMMCw1JykvL+e7mOWItueureWktOW9oueKtgogICAgICAgIC5hdHRyKCdmaWxsJywgJyM0ODNEOEInKTsKICAvLyDliqBsYWJlbAoKICBzZWxmLm15TGluayA9IGczLnNlbGVjdEFsbCgibXlQYXRoIikKCiAgICAgIC5kYXRhKGxpbmsxcykKICAgICAgLmVudGVyKCkKICAgICAgLmFwcGVuZCgicGF0aCIpCiAgICAgICAgLmF0dHIoImQiLCBmdW5jdGlvbihkKXsgcmV0dXJuIHBhdGgoZCl9KQogICAgICAgIC5zdHlsZSgiZmlsbCIsICJub25lIikKICAgICAgICAuc3R5bGUoInN0cm9rZSIsICIjNDgzRDgwIikKICAgICAgICAuc3R5bGUoInN0cm9rZS13aWR0aCIsIDIpCiAgICAgICAgLnN0eWxlKCJvcGFjaXR5IiwwLjQpCiAgICAgICAgLmF0dHIoIm1hcmtlci1lbmQiLCAidXJsKCNlbmQtYXJyb3cpIikKICAgICAgZzMuYXBwZW5kKCJwYXRoIikKICAgICAgICAuYXR0cigiZCIsIGQzLnN5bWJvbCgpLnR5cGUoZDMuc3ltYm9sU3Rhcikuc2l6ZSgyMDApKQogICAgICAgIC5hdHRyKCJmaWxsIiwncmVkJykKICAgICAgICAuYXR0cigidHJhbnNmb3JtIiwidHJhbnNsYXRlKDI5NywxNjYpIikKICBzZWxmLm15Q2lyY2xlID0gZzIuc2VsZWN0QWxsKCIucGxhY2UtcG9pbnQiKQogICAgICAuZGF0YShwbGFjZXMuZmVhdHVyZXMpCiAgICAuZW50ZXIoKQogICAgLmFwcGVuZCgiY2lyY2xlIikKICAgICAgLmF0dHIoImNsYXNzIiwgInBsYWNlLXBvaW50IikKICAgICAgLmF0dHIoInRyYW5zZm9ybSIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuICJ0cmFuc2xhdGUoIiArIHByb2plY3Rpb24oZC5nZW9tZXRyeS5jb29yZGluYXRlcykgKyAiKSI7IH0pCiAgICAgIC5hdHRyKCJ4IiwgZnVuY3Rpb24oZCkgeyByZXR1cm4gZC5nZW9tZXRyeS5jb29yZGluYXRlc1swXSA+IC0xID8gNiA6IC02OyB9KQogICAgICAuYXR0cigiZHkiLCAiLjM1ZW0iKQogICAgICAuYXR0cigiciIsIDQuOCkvL2Z1bmN0aW9uKGQpIHsgcmV0dXJuIGQucHJvcGVydGllcy5hZ2UvMTA7IH0pCiAgICAgIC5hdHRyKCJmaWxsIiwgZnVuY3Rpb24oZCl7cmV0dXJuIGNob29zZV9jb2xvcihkKX0pCiAgICAgIC5hdHRyKCJvcGFjaXR5IiwwLjcpCgoKICBzZWxmLnN2ZyA9IHN2ZwogIHZhciBzZSA9IFtdCiAgdmFyIHZlcnRpY2VzID0gW10KZm9yIChpID0gMCwgbGVuID0gcGxhY2VzLmZlYXR1cmVzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgdmFyIGQgPSBwbGFjZXMuZmVhdHVyZXNbaV0KICBzZS5wdXNoKHsnY29vcmRpbmF0ZXMnOnByb2plY3Rpb24oZC5nZW9tZXRyeS5jb29yZGluYXRlcyksJ2NvbG9yJzpjaG9vc2VfY29sb3IoZCl9KQogIHZlcnRpY2VzLnB1c2gocHJvamVjdGlvbihkLmdlb21ldHJ5LmNvb3JkaW5hdGVzKSkKfQpzZWxmLnZlcnRpY2VzID0gdmVydGljZXMKc2VsZi5HTE9CQUwuVmlzdWFsX3N0YXRlWydNYXAnXVsnb3ZlcmFsbCddID0gc2UKCnZhciBhbGxHcm91cCA9IFsnbm9uZScsInNlbGVjdCBhcmVhIiwgInpvb20iLCAic2hvdyBwb2ludCBpbmZvIl0KZHJvcGRvd25CdXR0b24ub24oImNoYW5nZSIsIGRyb3BjaGFuZ2UpCgovLyBhZGQgdGhlIG9wdGlvbnMgdG8gdGhlIGJ1dHRvbgpkcm9wZG93bkJ1dHRvbiAvLyBBZGQgYSBidXR0b24KICAuc2VsZWN0QWxsKCdteU9wdGlvbnMnKSAvLyBOZXh0IDQgbGluZXMgYWRkIDYgb3B0aW9ucyA9IDYgY29sb3JzCiAgLmRhdGEoYWxsR3JvdXApCiAgLmVudGVyKCkKICAuYXBwZW5kKCdvcHRpb24nKQogIC50ZXh0KGZ1bmN0aW9uIChkKSB7IHJldHVybiBkOyB9KSAvLyB0ZXh0IHNob3dlZCBpbiB0aGUgbWVudQogIC5hdHRyKCJ2YWx1ZSIsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkOyB9KSAKc2VsZi5kcm9wZG93bkJ1dHRvbiA9IGRyb3Bkb3duQnV0dG9uCnZhciB0b29sdGlwID0gZDMuc2VsZWN0KCJib2R5IikKICAgIC5hcHBlbmQoImRpdiIpCiAgICAuc3R5bGUoInBvc2l0aW9uIiwgImFic29sdXRlIikKICAgIC5zdHlsZSgiei1pbmRleCIsICIxMDAiKQogICAgLnN0eWxlKCJ2aXNpYmlsaXR5IiwgImhpZGRlbiIpCnZhciBnNCA9IGdyb3VwMS5hcHBlbmQoImciKS5hdHRyKCJpZCIsImZvcl9icnVzaCIpOyAvLwoKc2VsZi5nNCA9IGc0CmZ1bmN0aW9uIGRyb3BjaGFuZ2UoKXsKICB2YXIgbmV3Q2VyZWFsID0gZDMuc2VsZWN0KHRoaXMpLnByb3BlcnR5KCd2YWx1ZScpCiAgaWYgKG5ld0NlcmVhbD09J3pvb20nKXsKICAgIHNlbGYuem9vbV92YWx1ZSA9IFtdCiAgICBzdmcuY2FsbCh6b29tKQogICAgIGc0LnN0eWxlKCJkaXNwbGF5Iiwibm9uZSIpCnNlbGYuc3ZnLm9uKCJjbGljayIsIGZ1bmN0aW9uKCl7c2VsZi5HTE9CQUwuTG9nX2ZpbGUucHVzaChzZWxmLnpvb21fdmFsdWVbc2VsZi56b29tX3ZhbHVlLmxlbmd0aCAtIDFdKQogICAgc2VsZi5wb3N0SW50ZXJhY3Rpb24oeyduYW1lJzpzZWxmLkdMT0JBTC5Mb2dfZmlsZX0pfSkKICBzZWxmLm15Q2lyY2xlLm9uKCJtb3VzZW92ZXIiLCBmdW5jdGlvbigpe3JldHVybiBudWxsfSkKICAgIC5vbigibW91c2Vtb3ZlIiwgZnVuY3Rpb24oKXtyZXR1cm4gbnVsbH0pCiAgICAub24oIm1vdXNlb3V0IiwgZnVuY3Rpb24oKXtyZXR1cm4gbnVsbH0pCiAgICBkMy5zZWxlY3QoIiNtYXAiKQogICAgLm9uKCdtb3VzZW92ZXInLCBmdW5jdGlvbigpe3JldHVybiBudWxsfSkKICB9CiAgZWxzZSBpZiAobmV3Q2VyZWFsPT0nc2VsZWN0IGFyZWEnKXsKICAgIHN2Zy5vbignLnpvb20nLCBudWxsKQoKICAgIGc0LnN0eWxlKCJkaXNwbGF5IiwiYmxvY2siKQogIGc0CiAgICAuY2FsbCggZDMuYnJ1c2goKSAgICAgICAgICAgICAgICAgLy8gQWRkIHRoZSBicnVzaCBmZWF0dXJlIHVzaW5nIHRoZSBkMy5icnVzaCBmdW5jdGlvbgogICAgICAuZXh0ZW50KCBbIFswLDBdLCBbd2lkdGgsaGVpZ2h0XSBdICkgLy8gaW5pdGlhbGlzZSB0aGUgYnJ1c2ggYXJlYTogc3RhcnQgYXQgMCwwIGFuZCBmaW5pc2hlcyBhdCB3aWR0aCxoZWlnaHQ6IGl0IG1lYW5zIEkgc2VsZWN0IHRoZSB3aG9sZSBncmFwaCBhcmVhCiAgICAgIC5vbigiZW5kIiwgdXBkYXRhX2NoYXJ0KQogICAgKSAgICAKICB9CiAgZWxzZSBpZiAoKG5ld0NlcmVhbD09J3Nob3cgcG9pbnQgaW5mbycpKQogICAge3N2Zy5vbignLnpvb20nLCBudWxsKQogIHNlbGYubXlDaXJjbGUvLy5hdHRyKCJmaWxsIiwgZnVuY3Rpb24oZCl7cmV0dXJuIGNob29zZV9jb2xvcihkKX0pCiAgICAgIC5hdHRyKCJvcGFjaXR5IiwwLjcpCiAgICAgIC5hdHRyKCdyJyw0LjgpCiAgICAgIC5hdHRyKCdzdHJva2UnLG51bGwpCgogICAgICBnNC5zdHlsZSgiZGlzcGxheSIsIm5vbmUiKQogICAgLyoKICAgIHNlbGYuR0xPQkFMLkxvZ19maWxlLnB1c2goc2VsZi56b29tX3ZhbHVlW3NlbGYuem9vbV92YWx1ZS5sZW5ndGggLSAxXSkKICAgIGNvbnNvbGUubG9nKHNlbGYuem9vbV92YWx1ZVtzZWxmLnpvb21fdmFsdWUubGVuZ3RoIC0gMV0pCiAgICBzZWxmLnBvc3RJbnRlcmFjdGlvbih7J25hbWUnOnNlbGYuR0xPQkFMLkxvZ19maWxlfSkKICAgICovCgogICAgICBzZWxmLm15Q2lyY2xlLm9uKCJjbGljayIsIGZ1bmN0aW9uKGQpe2QzLnNlbGVjdCh0aGlzKS5hdHRyKCJmaWxsIiwiI0JDOEY4RiIpCiAgICAgIHNlbGYuR0xPQkFMLk5ld190aW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCkvMTAwMAogICAgICBpZiAoKHNlbGYuR0xPQkFMLk5ld190aW1lLXNlbGYuR0xPQkFMLk9sZF90aW1lKT4xKXsKICAgICAgc2VsZi5HTE9CQUwuVmlzdWFsX3N0YXRlWydNYXAnXVsndmlzaXQnXS5wdXNoKGQpLAogICAgICBCdXMuJGVtaXQoImNoYW5nZSIsIHNlbGYuR0xPQkFMLlZpc3VhbF9zdGF0ZSksCiAgICAgIGQzLnNlbGVjdCgiI21hcCIpCiAgLm9uKCdjbGljaycsIGZ1bmN0aW9uKCl7c2VsZi5HTE9CQUwuTG9nX2ZpbGUucHVzaChbJ3RpbWVzdGFtcCcsc2VsZi5HTE9CQUwuTmV3X3RpbWUsJ2hvdmVyLW1hcC1wb3NpdGlvbicsZDMubW91c2UodGhpcyksZC5wcm9wZXJ0aWVzLm5hbWUsJ1xuJ10pLHNlbGYucG9zdEludGVyYWN0aW9uKHsnbmFtZSc6c2VsZi5HTE9CQUwuTG9nX2ZpbGV9KSwgc2VsZi5HTE9CQUwuT2xkX3RpbWUgPSBzZWxmLkdMT0JBTC5OZXdfdGltZX0pCgogIH0KICByZXR1cm4gdG9vbHRpcC5zdHlsZSgidmlzaWJpbGl0eSIsICJ2aXNpYmxlIikuc3R5bGUoInRvcCIsKGQzLmV2ZW50LnBhZ2VZLTEwKSsicHgiKS5zdHlsZSgibGVmdCIsKGQzLmV2ZW50LnBhZ2VYKzEwKSsicHgiKS50ZXh0KGQucHJvcGVydGllcy5uYW1lKycsJytkLnByb3BlcnRpZXMuYWdlKyflsoEnKQp9KQogICAgLm9uKCJtb3VzZW91dCIsIGZ1bmN0aW9uKCl7cmV0dXJuIHRvb2x0aXAuc3R5bGUoInZpc2liaWxpdHkiLCAiaGlkZGVuIiksZDMuc2VsZWN0KHRoaXMpLnRyYW5zaXRpb24oKS5kdXJhdGlvbig1MDApLmF0dHIoImZpbGwiLCBmdW5jdGlvbihkKXtyZXR1cm4gY2hvb3NlX2NvbG9yKGQpfSk7fSkKICAgIH0KfQoKICBmdW5jdGlvbiB1cGRhdGFfY2hhcnQoKXsKICAgIHNlbGYubXlDaXJjbGUuYXR0cigib3BhY2l0eSIsMC43KQogICAgc2VsZi5teUxpbmsuc3R5bGUoIm9wYWNpdHkiLDAuNCkKICAgIHZhciBzZWxlY3RfZGF0YSA9IHVwZGF0ZV9kYXRhKCkKICBCdXMuJGVtaXQoIk1hcF9zZWxlY3RfZGF0YSIsIHNlbGVjdF9kYXRhKQogIH0KCiAgZnVuY3Rpb24gdXBkYXRlX2RhdGEoKSB7CiAgICB2YXIgc2VsZWN0X2RhdGEgPSBbXQogICAgdmFyIGV4dGVudCA9IGQzLmV2ZW50LnNlbGVjdGlvbgogICAgc2VsZi5teUNpcmNsZS5hdHRyKCJmaWxsIiwgZnVuY3Rpb24oZCl7cmV0dXJuIGNob29zZV9jb2xvcihkKX0pCiAgICBzZWxmLm15Q2lyY2xlLmNsYXNzZWQoInNlbGVjdGVkX2ZpcnN0IiwgZnVuY3Rpb24oZCl7IHJldHVybiBpc0JydXNoZWQoZXh0ZW50LCBwcm9qZWN0aW9uKGQuZ2VvbWV0cnkuY29vcmRpbmF0ZXMpWzBdLHByb2plY3Rpb24oZC5nZW9tZXRyeS5jb29yZGluYXRlcylbMV0pIH0pIAogICAgc2VsZi5HTE9CQUwuTmV3X3RpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKS8xMDAwCiAgICBpZigoc2VsZi5HTE9CQUwuTmV3X3RpbWUtc2VsZi5HTE9CQUwuT2xkX3RpbWUpPjEpewogICAgc2VsZi5HTE9CQUwuTG9nX2ZpbGUucHVzaChbJ3RpbWVzdGFtcCcsc2VsZi5HTE9CQUwuTmV3X3RpbWUsJ0JydXNoLU1hcC1Qb3NpdGlvbicsZXh0ZW50WzBdLGV4dGVudFsxXSwnXG4nXSkKICAgIHNlbGYucG9zdEludGVyYWN0aW9uKHsnbmFtZSc6c2VsZi5HTE9CQUwuTG9nX2ZpbGV9KQogICAgc2VsZi5HTE9CQUwuT2xkX3RpbWUgPSBzZWxmLkdMT0JBTC5OZXdfdGltZQogICAgLy9jb25zb2xlLmxvZygncicsc2VsZi5HTE9CQUwuR2V0X21lc3NhZ2UpCiAgICBmb3IoaT0wLCBsZW49c2VsZi5wbGFjZXMuZmVhdHVyZXMubGVuZ3RoLTE7IGk8bGVuOyBpKyspewogICAgICB2YXIgZCA9IHNlbGYucGxhY2VzLmZlYXR1cmVzW2ldCiAgICAgIGlmKGlzQnJ1c2hlZChleHRlbnQsIHByb2plY3Rpb24oZC5nZW9tZXRyeS5jb29yZGluYXRlcylbMF0scHJvamVjdGlvbihkLmdlb21ldHJ5LmNvb3JkaW5hdGVzKVsxXSkpCiAgICAgICAgey8vYSA9IGErcGFyc2VJbnQoZC5wcm9wZXJ0aWVzLmFnZSl9CiAgICAgICAgc2VsZWN0X2RhdGEucHVzaChkKX0KICAgICAgfQogICAgICByZXR1cm4gc2VsZWN0X2RhdGEKICAgICAgfQoKZnVuY3Rpb24gaXNCcnVzaGVkKGJydXNoX2Nvb3JkcywgY3gsIGN5KSB7CiAgICAgICB2YXIgeDAgPSBicnVzaF9jb29yZHNbMF1bMF0sCiAgICAgICAgICAgeDEgPSBicnVzaF9jb29yZHNbMV1bMF0sCiAgICAgICAgICAgeTAgPSBicnVzaF9jb29yZHNbMF1bMV0sCiAgICAgICAgICAgeTEgPSBicnVzaF9jb29yZHNbMV1bMV07CiAgICAgIHJldHVybiB4MCA8PSBjeCAmJiBjeCA8PSB4MSAmJiB5MCA8PSBjeSAmJiBjeSA8PSB5MTsgICAgLy8gVGhpcyByZXR1cm4gVFJVRSBvciBGQUxTRSBkZXBlbmRpbmcgb24gaWYgdGhlIHBvaW50cyBpcyBpbiB0aGUgc2VsZWN0ZWQgYXJlYQogIH0KCiAgfX0pfSwKdXBkYXRlKGF1dGhvcil7CnRoaXMuZzFfNS5zZWxlY3RBbGwoIioiKS5yZW1vdmUoKQp0aGlzLmcyLnNlbGVjdEFsbCgiKiIpLnJlbW92ZSgpCnRoaXMuZzMuc2VsZWN0QWxsKCIqIikucmVtb3ZlKCkKdGhpcy5wbGFjZV9jb2xvcl9zZWxlY3QgPSB0aGlzLnBsYWNlX2NvbG9yW2F1dGhvcl0KICAgICAgLy9jb25zdCB3aWR0aCA9IDUwMDsKICAgICAgLy9jb25zdCBoZWlnaHQgPSA2NDA7CnZhciBzdmcgPSB0aGlzLnN2Zwp2YXIgcHJvamVjdGlvbiA9IHRoaXMucHJvamVjdGlvbiAKdmFyIHBhdGggPSB0aGlzLnBhdGgKLy92YXIgZHJvcGRvd25CdXR0b24gPSB0aGlzLiBkcm9wZG93bkJ1dHRvbgpsZXQgc2VsZiA9IHRoaXMKICAgICAgZDMuanNvbigibWFwLmpzb24iLCBmdW5jdGlvbihlcnJvciwgcG9pbnQpIHsKICAgICAgdmFyIHBsYWNlc19hbGwgPSB0b3BvanNvbi5mZWF0dXJlKHBvaW50LCBwb2ludC5vYmplY3RzLnBsYWNlcykKCiAgICAgIHZhciBwbGFjZXMxID0gW10KICAgICAgZm9yKGkgaW4gcGxhY2VzX2FsbFsnZmVhdHVyZXMnXSl7CiAgICAgICAgaWYocGxhY2VzX2FsbFsnZmVhdHVyZXMnXVtpXS5wcm9wZXJ0aWVzLmF1dGhvcj09YXV0aG9yKXsKICAgICAgICAgIHBsYWNlczEucHVzaChwbGFjZXNfYWxsWydmZWF0dXJlcyddW2ldKQogICAgICAgIH0KICAgICAgfQogICAgICB2YXIgcGxhY2VzID0ge3R5cGU6ICJGZWF0dXJlQ29sbGVjdGlvbiIsZmVhdHVyZXM6cGxhY2VzMX0KICAgICAgc2VsZi5wbGFjZXMgPSBwbGFjZXMKICAgICAgc2VsZi5HTE9CQUwucGxhY2Vfbm93ID0gcGxhY2VzCiAgICAgIAogIHZhciBteUNvbG9yID0gZDMuc2NhbGVTZXF1ZW50aWFsKCkKICAgIC5kb21haW4oWzAuODMsMC40Ml0pCiAgICAuaW50ZXJwb2xhdG9yKGQzQ2hyb21hdGljLmludGVycG9sYXRlUGlZRyk7CiAgZnVuY3Rpb24gY2hvb3NlX2NvbG9yKHBsYWNlKXsKICAgIHZhciBuYW1lID0gcGxhY2UucHJvcGVydGllcy5uYW1lCiAgICB2YXIgcmVzID0gInJnYigxMDAsMTQ5LDIzNykiCiAgICBmb3IgKHZhciBpID0gMDtpPHNlbGYucGxhY2VfY29sb3Jfc2VsZWN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBzbGkgPSBzZWxmLnBsYWNlX2NvbG9yW2F1dGhvcl1baV0KICAgICAgaWYobmFtZSA9PSBzbGlbJ3BsYWNlJ10pewogICAgICAgIHJlcyA9IG15Q29sb3Ioc2xpWydzZW50aSddKQogICAgICB9CiAgICB9CiAgICByZXR1cm4gcmVzCiAgfQoKICAgICAgdmFyIGczID0gc2VsZi5nMwogICAgICB2YXIgZzIgPSBzZWxmLmcyCgovLyAKdmFyIGxpbmsxcyA9IFsKICB7dHlwZTogIkxpbmVTdHJpbmciLCBhZ2U6MCxjb29yZGluYXRlczogW1swLDBdLFswLDBdXX0KXQogICAgZm9yKHZhciBpPTAsIGxlbj1wbGFjZXMuZmVhdHVyZXMubGVuZ3RoLTE7IGk8bGVuOyBpKyspewogICAgLy8gKG5vdGU6IGxvb3AgdW50aWwgbGVuZ3RoIC0gMSBzaW5jZSB3ZSdyZSBnZXR0aW5nIHRoZSBuZXh0CiAgICAvLyAgaXRlbSB3aXRoIGkrMSkKICAgICAgICBsaW5rMXMucHVzaCh7CiAgICAgICAgICAgIHR5cGU6ICJMaW5lU3RyaW5nIiwKICAgICAgICAgICAgYWdlIDogcGxhY2VzLmZlYXR1cmVzW2ldLnByb3BlcnRpZXMuYWdlLAogICAgICAgICAgICBjb29yZGluYXRlczogWwogICAgICAgICAgICAgICAgWyBwbGFjZXMuZmVhdHVyZXNbaV0uZ2VvbWV0cnkuY29vcmRpbmF0ZXNbMF0sIHBsYWNlcy5mZWF0dXJlc1tpXS5nZW9tZXRyeS5jb29yZGluYXRlc1sxXV0sCiAgICAgICAgICAgICAgICBbIHBsYWNlcy5mZWF0dXJlc1tpKzFdLmdlb21ldHJ5LmNvb3JkaW5hdGVzWzBdLCBwbGFjZXMuZmVhdHVyZXNbaSsxXS5nZW9tZXRyeS5jb29yZGluYXRlc1sxXV1dCiAgICAgICAgfSk7CiAgICB9CiAgICBnMy5hcHBlbmQoJ3N2ZzpkZWZzJykuYXBwZW5kKCdzdmc6bWFya2VyJykKICAgICAgICAuYXR0cignaWQnLCAnZW5kLWFycm93JykKICAgICAgICAuYXR0cigndmlld0JveCcsICcwIC01IDggOCcpCiAgICAgICAgLmF0dHIoJ3JlZlgnLCA1KQogICAgICAgIC5hdHRyKCdtYXJrZXJXaWR0aCcsIDIuNSkvL+eureWktOWPguaVsOmAguW9k+aMiemcgOiwg+aVtAogICAgICAgIC5hdHRyKCdtYXJrZXJIZWlnaHQnLCAyLjUpCiAgICAgICAgLmF0dHIoJ29yaWVudCcsICdhdXRvJykKICAgICAgICAuYXBwZW5kKCdzdmc6cGF0aCcpCiAgICAgICAgLmF0dHIoJ2QnLCAnTTAsLTVMMTAsMEwwLDUnKS8v57uY5Yi2566t5aS05b2i54q2CiAgICAgICAgLmF0dHIoJ2ZpbGwnLCAnIzQ4M0Q4QicpOwogIC8vIOWKoGxhYmVsCgogIHNlbGYubXlMaW5rID0gZzMuc2VsZWN0QWxsKCJteVBhdGgiKQogICAgICAuZGF0YShsaW5rMXMpCiAgICAgIC5lbnRlcigpCiAgICAgIC5hcHBlbmQoInBhdGgiKQogICAgICAgIC5hdHRyKCJkIiwgZnVuY3Rpb24oZCl7IHJldHVybiBwYXRoKGQpfSkKICAgICAgICAuc3R5bGUoImZpbGwiLCAibm9uZSIpCiAgICAgICAgLnN0eWxlKCJzdHJva2UiLCAiIzQ4M0Q4MCIpCiAgICAgICAgLnN0eWxlKCJzdHJva2Utd2lkdGgiLCAyKQogICAgICAgIC5zdHlsZSgib3BhY2l0eSIsMC40KQogICAgICAgIC5hdHRyKCJtYXJrZXItZW5kIiwgInVybCgjZW5kLWFycm93KSIpCiAgICAgIGczLmFwcGVuZCgicGF0aCIpCiAgICAgICAgLmF0dHIoImQiLCBkMy5zeW1ib2woKS50eXBlKGQzLnN5bWJvbFN0YXIpLnNpemUoMjAwKSkKICAgICAgICAuYXR0cigiZmlsbCIsJ3JlZCcpCiAgICAgICAgLmF0dHIoInRyYW5zZm9ybSIsInRyYW5zbGF0ZSgyOTcsMTY2KSIpCiAgc2VsZi5teUNpcmNsZSA9IGcyLnNlbGVjdEFsbCgiLnBsYWNlLXBvaW50IikKICAgICAgLmRhdGEocGxhY2VzLmZlYXR1cmVzKQogICAgLmVudGVyKCkKICAgIC5hcHBlbmQoImNpcmNsZSIpCiAgICAgIC5hdHRyKCJjbGFzcyIsICJwbGFjZS1wb2ludCIpCiAgICAgIC5hdHRyKCJ0cmFuc2Zvcm0iLCBmdW5jdGlvbihkKSB7IHJldHVybiAidHJhbnNsYXRlKCIgKyBwcm9qZWN0aW9uKGQuZ2VvbWV0cnkuY29vcmRpbmF0ZXMpICsgIikiOyB9KQogICAgICAuYXR0cigieCIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQuZ2VvbWV0cnkuY29vcmRpbmF0ZXNbMF0gPiAtMSA/IDYgOiAtNjsgfSkKICAgICAgLmF0dHIoImR5IiwgIi4zNWVtIikKICAgICAgLmF0dHIoInIiLCA0LjgpLy9mdW5jdGlvbihkKSB7IHJldHVybiBkLnByb3BlcnRpZXMuYWdlLzEwOyB9KQogICAgICAuYXR0cigiZmlsbCIsIGZ1bmN0aW9uKGQpe3JldHVybiBjaG9vc2VfY29sb3IoZCl9KQogICAgICAuYXR0cigib3BhY2l0eSIsMC43KQoKCiAgc2VsZi5zdmcgPSBzdmcKICB2YXIgc2UgPSBbXQogIHZhciB2ZXJ0aWNlcyA9IFtdCmZvciAoaSA9IDAsIGxlbiA9IHBsYWNlcy5mZWF0dXJlcy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogIHZhciBkID0gcGxhY2VzLmZlYXR1cmVzW2ldCiAgc2UucHVzaCh7J2Nvb3JkaW5hdGVzJzpwcm9qZWN0aW9uKGQuZ2VvbWV0cnkuY29vcmRpbmF0ZXMpLCdjb2xvcic6Y2hvb3NlX2NvbG9yKGQpfSkKICB2ZXJ0aWNlcy5wdXNoKHByb2plY3Rpb24oZC5nZW9tZXRyeS5jb29yZGluYXRlcykpCn0Kc2VsZi52ZXJ0aWNlcyA9IHZlcnRpY2VzCnNlbGYuR0xPQkFMLlZpc3VhbF9zdGF0ZVsnTWFwJ11bJ292ZXJhbGwnXSA9IHNlfSkKCi8qCnZhciBhbGxHcm91cCA9IFsnbm9uZScsInNlbGVjdCBhcmVhIiwgInpvb20iLCAic2hvdyBwb2ludCBpbmZvIl0KZHJvcGRvd25CdXR0b24ub24oImNoYW5nZSIsIGRyb3BjaGFuZ2UpCgovLyBhZGQgdGhlIG9wdGlvbnMgdG8gdGhlIGJ1dHRvbgpkcm9wZG93bkJ1dHRvbiAvLyBBZGQgYSBidXR0b24KICAuc2VsZWN0QWxsKCdteU9wdGlvbnMnKSAvLyBOZXh0IDQgbGluZXMgYWRkIDYgb3B0aW9ucyA9IDYgY29sb3JzCiAgLmRhdGEoYWxsR3JvdXApCiAgLmVudGVyKCkKICAuYXBwZW5kKCdvcHRpb24nKQogIC50ZXh0KGZ1bmN0aW9uIChkKSB7IHJldHVybiBkOyB9KSAvLyB0ZXh0IHNob3dlZCBpbiB0aGUgbWVudQogIC5hdHRyKCJ2YWx1ZSIsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkOyB9KSAKCnZhciB0b29sdGlwID0gZDMuc2VsZWN0KCJib2R5IikKICAgIC5hcHBlbmQoImRpdiIpCiAgICAuc3R5bGUoInBvc2l0aW9uIiwgImFic29sdXRlIikKICAgIC5zdHlsZSgiei1pbmRleCIsICIxMDAiKQogICAgLnN0eWxlKCJ2aXNpYmlsaXR5IiwgImhpZGRlbiIpCnZhciBnNCA9IHNlbGYuZzQKc2VsZi5nNCA9IGc0CgpmdW5jdGlvbiBkcm9wY2hhbmdlKCl7CiAgdmFyIG5ld0NlcmVhbCA9IGQzLnNlbGVjdCh0aGlzKS5wcm9wZXJ0eSgndmFsdWUnKQogIGlmIChuZXdDZXJlYWw9PSd6b29tJyl7CiAgICBzZWxmLnpvb21fdmFsdWUgPSBbXQogICAgc3ZnLmNhbGwoem9vbSkKICAgICBnNC5zdHlsZSgiZGlzcGxheSIsIm5vbmUiKQpzZWxmLnN2Zy5vbigiY2xpY2siLCBmdW5jdGlvbigpe3NlbGYuR0xPQkFMLkxvZ19maWxlLnB1c2goc2VsZi56b29tX3ZhbHVlW3NlbGYuem9vbV92YWx1ZS5sZW5ndGggLSAxXSkKICAgIGNvbnNvbGUubG9nKHNlbGYuem9vbV92YWx1ZVtzZWxmLnpvb21fdmFsdWUubGVuZ3RoIC0gMV0pCiAgICBzZWxmLnBvc3RJbnRlcmFjdGlvbih7J25hbWUnOnNlbGYuR0xPQkFMLkxvZ19maWxlfSl9KQogIHNlbGYubXlDaXJjbGUub24oIm1vdXNlb3ZlciIsIGZ1bmN0aW9uKCl7cmV0dXJuIG51bGx9KQogICAgLm9uKCJtb3VzZW1vdmUiLCBmdW5jdGlvbigpe3JldHVybiBudWxsfSkKICAgIC5vbigibW91c2VvdXQiLCBmdW5jdGlvbigpe3JldHVybiBudWxsfSkKICAgIGQzLnNlbGVjdCgiI21hcCIpCiAgICAub24oJ21vdXNlb3ZlcicsIGZ1bmN0aW9uKCl7cmV0dXJuIG51bGx9KQogIH0KICBlbHNlIGlmIChuZXdDZXJlYWw9PSdzZWxlY3QgYXJlYScpewogICAgc3ZnLm9uKCcuem9vbScsIG51bGwpCiAgICAKCiAgICBnNC5zdHlsZSgiZGlzcGxheSIsImJsb2NrIikKICBnNAogICAgLmNhbGwoIGQzLmJydXNoKCkgICAgICAgICAgICAgICAgIC8vIEFkZCB0aGUgYnJ1c2ggZmVhdHVyZSB1c2luZyB0aGUgZDMuYnJ1c2ggZnVuY3Rpb24KICAgICAgLmV4dGVudCggWyBbMCwwXSwgW3dpZHRoLGhlaWdodF0gXSApIC8vIGluaXRpYWxpc2UgdGhlIGJydXNoIGFyZWE6IHN0YXJ0IGF0IDAsMCBhbmQgZmluaXNoZXMgYXQgd2lkdGgsaGVpZ2h0OiBpdCBtZWFucyBJIHNlbGVjdCB0aGUgd2hvbGUgZ3JhcGggYXJlYQogICAgICAub24oImVuZCIsIHVwZGF0YV9jaGFydCkKICAgICkgICAgCiAgfQogIGVsc2UgaWYgKChuZXdDZXJlYWw9PSdzaG93IHBvaW50IGluZm8nKSkKICAgIHtzdmcub24oJy56b29tJywgbnVsbCkKICAgICAgZzQuc3R5bGUoImRpc3BsYXkiLCJub25lIikKICAgIHNlbGYuR0xPQkFMLkxvZ19maWxlLnB1c2goc2VsZi56b29tX3ZhbHVlW3NlbGYuem9vbV92YWx1ZS5sZW5ndGggLSAxXSkKICAgIGNvbnNvbGUubG9nKHNlbGYuem9vbV92YWx1ZVtzZWxmLnpvb21fdmFsdWUubGVuZ3RoIC0gMV0pCiAgICBzZWxmLnBvc3RJbnRlcmFjdGlvbih7J25hbWUnOnNlbGYuR0xPQkFMLkxvZ19maWxlfSkKCgogICAgICBzZWxmLm15Q2lyY2xlLm9uKCJjbGljayIsIGZ1bmN0aW9uKGQpe2QzLnNlbGVjdCh0aGlzKS5hdHRyKCJmaWxsIiwiI0JDOEY4RiIpCiAgICAgIHNlbGYuR0xPQkFMLk5ld190aW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCkvMTAwMAogICAgICBpZiAoKHNlbGYuR0xPQkFMLk5ld190aW1lLXNlbGYuR0xPQkFMLk9sZF90aW1lKT4xKXsKICAgICAgc2VsZi5HTE9CQUwuVmlzdWFsX3N0YXRlWydNYXAnXVsndmlzaXQnXS5wdXNoKGQpLAogICAgICBCdXMuJGVtaXQoImNoYW5nZSIsIHNlbGYuR0xPQkFMLlZpc3VhbF9zdGF0ZSksCiAgICAgIGQzLnNlbGVjdCgiI21hcCIpCiAgLm9uKCdjbGljaycsIGZ1bmN0aW9uKCl7c2VsZi5HTE9CQUwuTG9nX2ZpbGUucHVzaChbJ3RpbWVzdGFtcCcsc2VsZi5HTE9CQUwuTmV3X3RpbWUsJ2hvdmVyLW1hcC1wb3NpdGlvbicsZDMubW91c2UodGhpcyksZC5wcm9wZXJ0aWVzLm5hbWUsJ1xuJ10pLHNlbGYucG9zdEludGVyYWN0aW9uKHsnbmFtZSc6c2VsZi5HTE9CQUwuTG9nX2ZpbGV9KSwgc2VsZi5HTE9CQUwuT2xkX3RpbWUgPSBzZWxmLkdMT0JBTC5OZXdfdGltZX0pCgogIH0KICByZXR1cm4gdG9vbHRpcC5zdHlsZSgidmlzaWJpbGl0eSIsICJ2aXNpYmxlIikuc3R5bGUoInRvcCIsKGQzLmV2ZW50LnBhZ2VZLTEwKSsicHgiKS5zdHlsZSgibGVmdCIsKGQzLmV2ZW50LnBhZ2VYKzEwKSsicHgiKS50ZXh0KGQucHJvcGVydGllcy5uYW1lKycsJytkLnByb3BlcnRpZXMuYWdlKyflsoEnKQp9KQogICAgLm9uKCJtb3VzZW91dCIsIGZ1bmN0aW9uKCl7cmV0dXJuIHRvb2x0aXAuc3R5bGUoInZpc2liaWxpdHkiLCAiaGlkZGVuIiksZDMuc2VsZWN0KHRoaXMpLnRyYW5zaXRpb24oKS5kdXJhdGlvbig1MDApLmF0dHIoImZpbGwiLCBmdW5jdGlvbihkKXtyZXR1cm4gY2hvb3NlX2NvbG9yKGQpfSk7fSkKICAgIH0KfQoKICBmdW5jdGlvbiB1cGRhdGFfY2hhcnQoKXsKICAgIHNlbGYubXlDaXJjbGUuYXR0cigib3BhY2l0eSIsMC43KQogICAgc2VsZi5teUxpbmsuc3R5bGUoIm9wYWNpdHkiLDAuNCkKICAgIHZhciBzZWxlY3RfZGF0YSA9IHVwZGF0ZV9kYXRhKCkKICBCdXMuJGVtaXQoIk1hcF9zZWxlY3RfZGF0YSIsIHNlbGVjdF9kYXRhKQogIH0KCiAgZnVuY3Rpb24gdXBkYXRlX2RhdGEoKSB7CiAgICB2YXIgc2VsZWN0X2RhdGEgPSBbXQogICAgdmFyIGV4dGVudCA9IGQzLmV2ZW50LnNlbGVjdGlvbgogICAgc2VsZi5teUNpcmNsZS5hdHRyKCJmaWxsIiwgZnVuY3Rpb24oZCl7cmV0dXJuIGNob29zZV9jb2xvcihkKX0pCiAgICBzZWxmLm15Q2lyY2xlLmNsYXNzZWQoInNlbGVjdGVkX2ZpcnN0IiwgZnVuY3Rpb24oZCl7IHJldHVybiBpc0JydXNoZWQoZXh0ZW50LCBwcm9qZWN0aW9uKGQuZ2VvbWV0cnkuY29vcmRpbmF0ZXMpWzBdLHByb2plY3Rpb24oZC5nZW9tZXRyeS5jb29yZGluYXRlcylbMV0pIH0pIAogICAgc2VsZi5HTE9CQUwuTmV3X3RpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKS8xMDAwCiAgICBpZigoc2VsZi5HTE9CQUwuTmV3X3RpbWUtc2VsZi5HTE9CQUwuT2xkX3RpbWUpPjEpewogICAgc2VsZi5HTE9CQUwuTG9nX2ZpbGUucHVzaChbJ3RpbWVzdGFtcCcsc2VsZi5HTE9CQUwuTmV3X3RpbWUsJ0JydXNoLU1hcC1Qb3NpdGlvbicsZXh0ZW50WzBdLGV4dGVudFsxXSwnXG4nXSkKICAgIHNlbGYucG9zdEludGVyYWN0aW9uKHsnbmFtZSc6c2VsZi5HTE9CQUwuTG9nX2ZpbGV9KQogICAgc2VsZi5HTE9CQUwuT2xkX3RpbWUgPSBzZWxmLkdMT0JBTC5OZXdfdGltZQogICAgLy9jb25zb2xlLmxvZygncicsc2VsZi5HTE9CQUwuR2V0X21lc3NhZ2UpCiAgICBmb3IoaT0wLCBsZW49cGxhY2VzLmZlYXR1cmVzLmxlbmd0aC0xOyBpPGxlbjsgaSsrKXsKICAgICAgdmFyIGQgPSBwbGFjZXMuZmVhdHVyZXNbaV0KICAgICAgaWYoaXNCcnVzaGVkKGV4dGVudCwgcHJvamVjdGlvbihkLmdlb21ldHJ5LmNvb3JkaW5hdGVzKVswXSxwcm9qZWN0aW9uKGQuZ2VvbWV0cnkuY29vcmRpbmF0ZXMpWzFdKSkKICAgICAgICB7Ly9hID0gYStwYXJzZUludChkLnByb3BlcnRpZXMuYWdlKX0KICAgICAgICBzZWxlY3RfZGF0YS5wdXNoKGQpfQogICAgICB9CiAgICAgIHJldHVybiBzZWxlY3RfZGF0YQogICAgICB9CgpmdW5jdGlvbiBpc0JydXNoZWQoYnJ1c2hfY29vcmRzLCBjeCwgY3kpIHsKICAgICAgIHZhciB4MCA9IGJydXNoX2Nvb3Jkc1swXVswXSwKICAgICAgICAgICB4MSA9IGJydXNoX2Nvb3Jkc1sxXVswXSwKICAgICAgICAgICB5MCA9IGJydXNoX2Nvb3Jkc1swXVsxXSwKICAgICAgICAgICB5MSA9IGJydXNoX2Nvb3Jkc1sxXVsxXTsKICAgICAgcmV0dXJuIHgwIDw9IGN4ICYmIGN4IDw9IHgxICYmIHkwIDw9IGN5ICYmIGN5IDw9IHkxOyAgICAvLyBUaGlzIHJldHVybiBUUlVFIG9yIEZBTFNFIGRlcGVuZGluZyBvbiBpZiB0aGUgcG9pbnRzIGlzIGluIHRoZSBzZWxlY3RlZCBhcmVhCiAgfQoKICB9fSkKKi99LAoKc2VsZWN0X25ld19wb2ludCgpewogICAgdmFyIGRhdGEgPSB0aGlzLkhpc3Rfc2VsZWN0X2RhdGEKICAgIHRoaXMubXlDaXJjbGUuY2xhc3NlZCgic2VsZWN0ZWRfc2Vjb25kIiwgZnVuY3Rpb24oZCl7cmV0dXJuIGlzU2VsZWN0ZWRCeUhpc3QoZCxkYXRhKX0pCiAgICAvL3RoaXMubXlMaW5rLnN0eWxlKCJzdHJva2UiLGZ1bmN0aW9uKGQpIHtyZXR1cm4gTGlua2lzU2VsZWN0ZWRCeUhpc3QoZCl9KQogICAgLy90aGlzLm15TGluay5zdHlsZSgib3BhY2l0eSIsZnVuY3Rpb24oZCkge3JldHVybiBMaW5raXNTZWxlY3RlZEJ5SGlzdF9PKGQpfSkKICAgIC8vdGhpcy5teUxpbmsuc3R5bGUoInN0cm9rZS13aWR0aCIsZnVuY3Rpb24oZCkge3JldHVybiBMaW5raXNTZWxlY3RlZEJ5SGlzdF9TKGQpfSkKICAgIApmdW5jdGlvbiBpc1NlbGVjdGVkQnlIaXN0KGEsZGF0YSl7CiAgZm9yKHZhciBpPTAsbGVuPWRhdGEubGVuZ3RoO2k8bGVuO2krKyl7CiAgICB2YXIgZ2VvID0gZGF0YVtpXS5wcm9wZXJ0aWVzLm5hbWUKICAgIHZhciBhZ2Vfc2VsZWN0ID0gZGF0YVtpXS5wcm9wZXJ0aWVzLmFnZQogICAgaWYgKGEucHJvcGVydGllcy5uYW1lPT1nZW8pewogICAgICBpZihhLnByb3BlcnRpZXMuYWdlPT1hZ2Vfc2VsZWN0KXsKICAgICAgICByZXR1cm4gKDE9PTEpCiAgICAgIH19fQogIHJldHVybiAoMT09MCl9Cn0sCnNlbGVjdF9uZXdfcG9pbnRfRm9yY2UoKXsKICB2YXIgZGF0YSA9IHRoaXMuRm9yY2Vfc2VsZWN0X2RhdGEKICB0aGlzLm15Q2lyY2xlLmNsYXNzZWQoInNlbGVjdGVkX3NlY29uZCIsIGZ1bmN0aW9uKGQpe3JldHVybiBkLnByb3BlcnRpZXMubmFtZT09ZGF0YX0pCn0sCnNob3dfcGVyaW9kKCl7CiAgdGhpcy5nNC5zdHlsZSgiZGlzcGxheSIsIm5vbmUiKQogIGxldCBzZWxmID0gdGhpcwogIHZhciBteUNvbG9yID0gZDMuc2NhbGVTZXF1ZW50aWFsKCkKICAgIC5kb21haW4oWzAuODMsMC40Ml0pCiAgICAuaW50ZXJwb2xhdG9yKGQzQ2hyb21hdGljLmludGVycG9sYXRlUGlZRyk7CiAgZnVuY3Rpb24gY2hvb3NlX2NvbG9yKHBsYWNlKXsKICAgIHZhciBuYW1lID0gcGxhY2UucHJvcGVydGllcy5uYW1lCiAgICB2YXIgcmVzID0gInJnYigxMDAsMTQ5LDIzNykiCiAgICBmb3IgKHZhciBpID0gMDtpPHNlbGYucGxhY2VfY29sb3Jfc2VsZWN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBzbGkgPSBzZWxmLnBsYWNlX2NvbG9yX3NlbGVjdFtpXQogICAgICBpZihuYW1lID09IHNsaVsncGxhY2UnXSl7CiAgICAgICAgcmVzID0gbXlDb2xvcihzbGlbJ3NlbnRpJ10pCiAgICAgIH0KICAgIH0KICAgIHJldHVybiByZXMKICB9CgogIGZ1bmN0aW9uIGNob29zZV9pZChwbGFjZSl7CiAgICB2YXIgbmFtZSA9IHBsYWNlLnByb3BlcnRpZXMubmFtZQogICAgdmFyIHJlcyA9IDUKICAgIGZvciAodmFyIGkgPSAwO2k8c2VsZi5wbGFjZV9jb2xvcl9zZWxlY3QubGVuZ3RoOyBpKyspIHsKICAgICAgdmFyIHNsaSA9IHNlbGYucGxhY2VfY29sb3Jfc2VsZWN0W2ldCiAgICAgIGlmKG5hbWUgPT0gc2xpWydwbGFjZSddKXsKICAgICAgICB2YXIgc2VudGkgPSBzbGlbJ3NlbnRpJ10KICAgICAgICBpZihzZW50aTwwLjUwMil7CiAgICAgICAgICByZXMgPSAwCiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKChzZW50aT4wLjUwMikmKHNlbnRpPDAuNTg0KSl7cmVzID0gMX0KICAgICAgICBlbHNlIGlmICgoc2VudGk+MC41ODQpJihzZW50aTwwLjY2Nikpe3JlcyA9IDJ9CiAgICAgICAgZWxzZSBpZiAoKHNlbnRpPjAuNjY2KSYoc2VudGk8MC43NDgpKXtyZXMgPSAzfQogICAgICAgIGVsc2UgaWYgKChzZW50aT4wLjc0OCkpe3JlcyA9IDR9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiByZXMKICB9CiAgdGhpcy5teUNpcmNsZS5hdHRyKCJmaWxsIiwgZnVuY3Rpb24oZCl7cmV0dXJuIGNob29zZV9jb2xvcihkKX0pCiAgdGhpcy5teUNpcmNsZS5hdHRyKCJvcGFjaXR5IixmdW5jdGlvbihkKXsKICAgIHZhciBpZCA9IGNob29zZV9pZChkKQogICAgaWYoc2VsZi5ob3Zlcl9wZXJpb2Q9PTYpewogICAgICAgcmV0dXJuIDAuNwogICAgfQogICAgaWYoaWQ9PXNlbGYuaG92ZXJfcGVyaW9kKXsKICAgICAgcmV0dXJuIDEKICAgIH0KICAgIGVsc2V7cmV0dXJuIDB9CiAgfSkKICB0aGlzLm15TGluay5zdHlsZSgib3BhY2l0eSIsZnVuY3Rpb24oKXsKICAgIGlmKHNlbGYuaG92ZXJfcGVyaW9kPT02KXsgcmV0dXJuIDAuNH0KICAgIGVsc2V7cmV0dXJuIDB9CiAgfSl9LApHZXRfUHJlZGljdChwcmVkaWN0X2FsbCl7CiAgY29uc29sZS5sb2coJ01hcF9HZXRfUHJlZGljdCcpCiAgdGhpcy5nMV81LnNlbGVjdEFsbCgiKiIpLnJlbW92ZSgpCiAgZm9yKHZhciBpIGluIHByZWRpY3RfYWxsKXsKICAgIHZhciBwcmVkaWN0ID0gcHJlZGljdF9hbGxbaV0KICAgIHZhciBwb3NpdGlvbiA9IHByZWRpY3RbJ0JlaGF2aW9yJ10KICAgIGNvbnNvbGUubG9nKCdwb3NpdGlvbicscG9zaXRpb24pCiAgaWYgKHByZWRpY3RbJ3R5cGUnXT09J0JydXNoJyl7CiAgICB2YXIgeF8xID0gTWF0aC5taW4oTWF0aC5tYXgoMCxwb3NpdGlvblsneF9wb3NpdGlvbjEnXSksNTAwKQogICAgdmFyIHlfMSA9IE1hdGgubWluKE1hdGgubWF4KDAscG9zaXRpb25bJ3lfcG9zaXRpb24xJ10pLDY1MCkKICAgIHZhciB4XzIgPSBNYXRoLm1pbihNYXRoLm1heCh4XzErMjAscG9zaXRpb25bJ3hfcG9zaXRpb24yJ10pLDUwMCkKICAgIHZhciB5XzIgPSBNYXRoLm1pbihNYXRoLm1heCh5XzErMjAscG9zaXRpb25bJ3lfcG9zaXRpb24yJ10pLDY1MCkKCiAgICB0aGlzLmcxXzUuYXBwZW5kKCdyZWN0JykKICAuYXR0cigneCcsIHhfMSkKICAuYXR0cigneScsIHlfMSkKICAuYXR0cignd2lkdGgnLCB4XzIteF8xKQogIC5hdHRyKCdoZWlnaHQnLCB5XzIteV8xKQogIC5hdHRyKCdzdHJva2UnLCAnYmxhY2snKQogIC5hdHRyKCdzdHJva2Utd2lkdGgnLCIxcHgiKQogIC5hdHRyKCJvcGFjaXR5IiwwLjUpCiAgLmF0dHIoJ2ZpbGwnLCAnIzY5YTNiMicpOwoKICAgICAgdGhpcy5nMV81LmFwcGVuZCgndGV4dCcpCiAgLmF0dHIoJ3gnLCB4XzEpCiAgLmF0dHIoJ3knLCB5XzEpCiAgLnRleHQoJ0JydXNoJykKICAuYXR0cignc3Ryb2tlJywgJ2JsYWNrJykKICAuYXR0cignc3Ryb2tlLXdpZHRoJywiMXB4IikKICAuc3R5bGUoImZvbnQtc2l6ZSIsIjE0cHgiKTsKICB9CiAgCiAgaWYgKHByZWRpY3RbJ3R5cGUnXT09J1pvb20nKXsKICAgIHZhciBzY2FsZSA9IHBvc2l0aW9uWydzY2FsZSddCiAgICB2YXIgZGVsdGFfeCA9IHBvc2l0aW9uWydkZWx0YV94J10KICAgIHZhciBkZWx0YV95ID0gcG9zaXRpb25bJ2RlbHRhX3knXQogICAgdmFyIHdpZHRoX3JlYyA9IDUwMC9zY2FsZQogICAgdmFyIGhlaWdodF9yZWMgPSA2NDAvc2NhbGUKICAgIHZhciB4MSA9IE1hdGgubWF4KDAsLWRlbHRhX3gpCiAgICB2YXIgeTEgPSBNYXRoLm1heCgwLC1kZWx0YV95KQogICAgICAgIHRoaXMuZzFfNS5hcHBlbmQoJ3JlY3QnKQogIC5hdHRyKCd4JywgeDEpCiAgLmF0dHIoJ3knLCB5MSkKICAuYXR0cignd2lkdGgnLCB3aWR0aF9yZWMpCiAgLmF0dHIoJ2hlaWdodCcsIGhlaWdodF9yZWMpCiAgLmF0dHIoJ3N0cm9rZScsICdibGFjaycpCiAgLmF0dHIoJ3N0cm9rZS13aWR0aCcsIjFweCIpCiAgLmF0dHIoIm9wYWNpdHkiLDAuMSkKICAuYXR0cignZmlsbCcsICcjNjlhM2IyJyk7CgogICAgICB0aGlzLmcxXzUuYXBwZW5kKCd0ZXh0JykKICAuYXR0cigneCcsIHgxKQogIC5hdHRyKCd5JywgeTEpCiAgLnRleHQoJ1pvb20nKQogIC5hdHRyKCdzdHJva2UnLCAnYmxhY2snKQogIC5hdHRyKCdzdHJva2Utd2lkdGgnLCIycHgiKQogIC5zdHlsZSgiZm9udC1zaXplIiwiMTRweCIpOwogIH0KICAKICBpZiAocHJlZGljdFsndHlwZSddPT0nQ2xpY2snKXsKICAgIGlmKHByZWRpY3RbJ09iamVjdF9WaWV3J109PSdNYXAnKXsKICAgIHZhciB4X3Bvc2l0aW9uID0gcG9zaXRpb25bJ3hfcG9zaXRpb24nXQogICAgdmFyIHlfcG9zaXRpb24gPSBwb3NpdGlvblsneV9wb3NpdGlvbiddCiAgICB2YXIgZGlzdCA9IDAKICAgIHZhciBtaW5fZGlzdCA9IE51bWJlci5QT1NJVElWRV9JTkZJTklUWQogICAgdmFyIGRpc3MgPSAwCiAgICBmb3IoaSBpbiB0aGlzLnZlcnRpY2VzKXsKICAgICAgdmFyIGQgPSB0aGlzLnZlcnRpY2VzW2ldCiAgICAgIGRpc3QgPSAoeF9wb3NpdGlvbi1kWzBdKSoqMisoeV9wb3NpdGlvbi1kWzFdKSoqMgogICAgICBpZiAoZGlzdDxtaW5fZGlzdCl7CiAgICAgICAgZGlzcyA9IGQKICAgICAgICBtaW5fZGlzdCA9IGRpc3QKICAgICAgfQogICAgfQogICAgdGhpcy5nMV81LmFwcGVuZCgnY2lyY2xlJykKICAuYXR0cignY3gnLCBkaXNzWzBdKQogIC5hdHRyKCdjeScsIGRpc3NbMV0pCiAgLmF0dHIoJ3InLCA3KQogIC5hdHRyKCdzdHJva2UnLCAnYmxhY2snKQogIC5hdHRyKCJzdHJva2Utd2lkdGgiLCc0cHgnKQogIC5hdHRyKCJvcGFjaXR5IiwxKQogIC5hdHRyKCdmaWxsJywgJyM2OWEzYjInKTt9fQogIH0KCgp9Cgp9fQo="},{"version":3,"sources":["Map.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAgBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;;AAEA","file":"Map.vue","sourceRoot":"src/components","sourcesContent":["/* eslint-disable */\n<template>\n  <div>\n    <div style = \"width:380px;height:44px;float:left\">\n      <h4>Footprint</h4>\n    </div>\n    <div id = 'pos'  style = \"width:120px;height:24px;float:left\">\n      <p>  </p>\n\n    </div>\n  <div id=\"map\">\n  </div>\n</div>\n</template>\n\n<script>\nimport * as d3 from \"d3\";\nimport * as topojson from \"topojson\"\nimport * as d3Chromatic from 'd3-scale-chromatic';\n//import Vue from 'vue';\nimport Bus from '../assets/bus.js';\n//import * as d3Voronoi from 'd3-voronoi'\n//var msgCenter = new Vue()\nexport default {\n  name: \"App\",\n  data() {\n    return {\n      place_color:'',\n      select_data:'',\n      Hist_select_data:'',\n      Force_select_data:'',\n      myCircle:'',\n      myLink:'',\n      svg:'',\n      hover_period:'',\n      g4:'',\n      g3:'', \n      g2:'',\n      zoom_value:[],\n      g1_5:'',\n      vertices:'',\n      group1:'',\n      g1:'',\n      projection:'',\n      path:'',\n      dropdownButton:'',\n      subunits:'',\n      places:''\n    };\n  },\n  //created() {\n    // 在需要的传递数据的时候调用sendData方法，这里模拟调用\n    //this.sendData();\n    \n  //},\n  mounted() {\n    this.getMap();\n    this.handle()\n    //this.sendData();\n  },\n  methods: {\n    handle: function () {\n    Bus.$on(\"subunits\",()=>{this.generateArc()})\n    Bus.$on(\"New_Poet\", (val) => {\n      this.update(val)}),  \n    Bus.$on(\"hover_period\", (val) => {\n      this.hover_period=val;\n      this.show_period()}),\n    Bus.$emit(\"Map_age\", this.select_value),\n    Bus.$on(\"Hist_select_data\", (val) => {\n      this.Hist_select_data=val;\n      this.select_new_point()}),\n    Bus.$on(\"change\", () => {\n      var time = new Date().getTime()/1000\n\n      this.GLOBAL.Visual_state['timestamp'] = time\n      var save = JSON.stringify(this.GLOBAL.Visual_state)\n\n      this.GLOBAL.Visual_state_All.push([time,save])\n      this.postVisual({'name':this.GLOBAL.Visual_state})}),  \n    Bus.$on(\"Force_select_data\", (val) => {\n      this.Force_select_data=val;\n      this.select_new_point_Force()})\n    Bus.$on(\"Get_Predict\",(val) => {this.Get_Predict(val)})},\n    getMap(){\n      let self = this\n        d3.json(\"sushi_map.json\", function(error, point) {\n        self.subunits = topojson.feature(point, point.objects.china)\n        Bus.$emit(\"subunits\",self.subunits)\n})\n    },\n    generateArc() {\n      const width = 500;\n      const height = 640;\n\n      const projection = d3.geoAlbers()\n          .center([2, 29.6])\n          .rotate([-110, 0])\n          .parallels([20, 60])\n          .translate([width / 2, height / 2])\n          .scale(1600)\n      this.projection = projection\n\n      const path = d3.geoPath()\n          .projection(projection)\n          .pointRadius(2);\n      this.path = path\n      var dropdownButton = d3.select(\"#pos\")\n      .append('select').attr(\"x\",\"100px\")\n      \n      const svg = d3\n        .select(\"#map\")\n        .append(\"svg\")\n        .attr(\"width\", width)\n        .attr(\"height\", height);\n      let self = this\n      d3.csv(\"place_senti2.csv\",function(data_all){\n        var data = {'Su Shi':[],'Huang Tingjian':[],'Ouyang Xiu':[],'Xin Qiji':[]}\n        for(var i in data_all){\n          if(data_all[i]['author']=='Su Shi'){\n            data['Su Shi'].push(data_all[i])\n          }\n          else if(data_all[i]['author']=='Huang Tingjian'){\n            data['Huang Tingjian'].push(data_all[i])\n          }\n          else if(data_all[i]['author']=='Ouyang Xiu'){\n            data['Ouyang Xiu'].push(data_all[i])\n          }\n          else if(data_all[i]['author']=='Xin Qiji'){\n            data['Xin Qiji'].push(data_all[i])\n          }          \n        }\n        self.place_color = data\n        self.place_color_select = data['Su Shi']\n      })\n      d3.json(\"map.json\", function(error, point) {\n      var subunits = self.subunits\n      var places_all = topojson.feature(point, point.objects.places)\n      var places1 = []\n      for(i in places_all['features']){\n        if(places_all['features'][i].properties.author=='Su Shi'){\n          places1.push(places_all['features'][i])\n        }\n      }\n      var places = {type: \"FeatureCollection\",features:places1}\n      self.places = places\n      self.GLOBAL.place_now = places\n      Bus.$emit('Start_Place', places)\n  var myColor = d3.scaleSequential()\n    .domain([0.83,0.42])\n    .interpolator(d3Chromatic.interpolatePiYG);\n  function choose_color(place){\n    var name = place.properties.name\n    var res = \"rgb(100,149,237)\"\n    for (var i = 0;i<self.place_color_select.length; i++) {\n      var sli = self.place_color_select[i]\n      if(name == sli['place']){\n        res = myColor(sli['senti'])\n      }\n    }\n    return res\n  }\n\n  var zoom = d3.zoom()\n      .scaleExtent([0.5,3])//用于设置最小和最大的缩放比例\n      .on(\"zoom\",zoomed) \n/*\nself.GLOBAL.New_time = new Date().getTime()/1000\nself.GLOBAL.Old_time = self.GLOBAL.New_time\nself.GLOBAL.Log_file.push(['Start_timestamp',self.GLOBAL.New_time,'\\n'])\nself.postInteraction({'name':self.GLOBAL.Log_file})*/\n//编写 平移函数\n/*\nfunction reset() {\n    \n      svg.transition().duration(750).call( //duration过渡时间\n        zoom.transform,\n        d3.zoomIdentity, //控制缩放中心的为鼠标当前位置\n        d3.zoomTransform(svg.node()).invert([width / 2, height / 2]) //弹性动画的圆心位置\n      );\n}*/\n// 缩放函数\n\nfunction zoomed() {\n    const transform = d3.event.transform; //识别鼠标事件\n    self.GLOBAL.New_time = new Date().getTime()/1000\n      self.zoom_value.push(['timestamp',new Date().getTime()/1000,'Zoom-Map-Value',transform,'\\n'])\n    self.GLOBAL.Old_time = self.GLOBAL.New_time\n    \n    group1.attr(\"transform\", transform); //将缩放结果传给g\n    var k = Math.sqrt(100 / projection.scale()); //修改地图尺寸\n    group1.attr(\"stroke-width\", 1 / k); //修改对应的属性\n    return transform\n}\n    var group1 = svg.append(\"g\").attr(\"id\",\"group\").datum({\n    x: 0,\n    y: 0\n  })//.on(\"click\", reset);  //定义点击事件\n      var g1 = group1.append(\"g\").attr(\"id\",\"for_path\"); \n      //var g0 = group.append(\"g\").attr(\"id\",\"for_vo\"); //新增组，用于存储不同对象\n      var g1_5 = group1.append(\"g\").attr(\"id\",\"for_interaction_suggestion\"); //\n      self.g1_5 = g1_5\n      var g3 = group1.append(\"g\").attr(\"id\",\"for_line\").attr(\"pointer-events\",\"none\");\n      var g2 = group1.append(\"g\").attr(\"id\",\"for_circle\");\nself.g2 = g2\nself.g3 = g3\n// \n\n\ng1.selectAll(\".subunit\")\n      .data(subunits.features)\n    .enter().append(\"path\")\n      .attr(\"class\", function(d) { return \"subunit \" + d.id; })\n      .attr(\"d\", path)\n      .attr('stroke','#222')\n      .attr('stroke-width','1px')\n      .attr('fill',function(d){var p = d.properties.name\n        if((p=='山西省')|(p=='陕西省')|(p=='河南省')|(p=='河北省')|(p=='北京市')|\n          (p=='天津市')|(p=='河南省')|(p=='山东省')|(p=='江苏省')|(p=='浙江省')|\n          (p=='上海市')|(p=='湖南省')|(p=='湖北省')|(p=='江西省')|(p=='重庆市')|\n          (p=='四川省')|(p=='广西壮族自治区')|(p=='海南省')|(p=='广东省')|(p=='贵州省')|\n          (p=='福建省')|(p=='安徽省')){return '#ccc'}\n        else{return '#fff'}})\n\nvar link1s = [\n  {type: \"LineString\", age:0,coordinates: [[0,0],[0,0]]}\n]\n    for(var i=0, len=places.features.length-1; i<len; i++){\n    // (note: loop until length - 1 since we're getting the next\n    //  item with i+1)\n        link1s.push({\n            type: \"LineString\",\n            age : places.features[i].properties.age,\n            coordinates: [\n                [ places.features[i].geometry.coordinates[0], places.features[i].geometry.coordinates[1]],\n                [ places.features[i+1].geometry.coordinates[0], places.features[i+1].geometry.coordinates[1]]]\n        });\n    }\n    g3.append('svg:defs').append('svg:marker')\n        .attr('id', 'end-arrow')\n        .attr('viewBox', '0 -5 8 8')\n        .attr('refX', 5)\n        .attr('markerWidth', 2.5)//箭头参数适当按需调整\n        .attr('markerHeight', 2.5)\n        .attr('orient', 'auto')\n        .append('svg:path')\n        .attr('d', 'M0,-5L10,0L0,5')//绘制箭头形状\n        .attr('fill', '#483D8B');\n  // 加label\n\n  self.myLink = g3.selectAll(\"myPath\")\n\n      .data(link1s)\n      .enter()\n      .append(\"path\")\n        .attr(\"d\", function(d){ return path(d)})\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", \"#483D80\")\n        .style(\"stroke-width\", 2)\n        .style(\"opacity\",0.4)\n        .attr(\"marker-end\", \"url(#end-arrow)\")\n      g3.append(\"path\")\n        .attr(\"d\", d3.symbol().type(d3.symbolStar).size(200))\n        .attr(\"fill\",'red')\n        .attr(\"transform\",\"translate(297,166)\")\n  self.myCircle = g2.selectAll(\".place-point\")\n      .data(places.features)\n    .enter()\n    .append(\"circle\")\n      .attr(\"class\", \"place-point\")\n      .attr(\"transform\", function(d) { return \"translate(\" + projection(d.geometry.coordinates) + \")\"; })\n      .attr(\"x\", function(d) { return d.geometry.coordinates[0] > -1 ? 6 : -6; })\n      .attr(\"dy\", \".35em\")\n      .attr(\"r\", 4.8)//function(d) { return d.properties.age/10; })\n      .attr(\"fill\", function(d){return choose_color(d)})\n      .attr(\"opacity\",0.7)\n\n\n  self.svg = svg\n  var se = []\n  var vertices = []\nfor (i = 0, len = places.features.length; i < len; i++) {\n  var d = places.features[i]\n  se.push({'coordinates':projection(d.geometry.coordinates),'color':choose_color(d)})\n  vertices.push(projection(d.geometry.coordinates))\n}\nself.vertices = vertices\nself.GLOBAL.Visual_state['Map']['overall'] = se\n\nvar allGroup = ['none',\"select area\", \"zoom\", \"show point info\"]\ndropdownButton.on(\"change\", dropchange)\n\n// add the options to the button\ndropdownButton // Add a button\n  .selectAll('myOptions') // Next 4 lines add 6 options = 6 colors\n  .data(allGroup)\n  .enter()\n  .append('option')\n  .text(function (d) { return d; }) // text showed in the menu\n  .attr(\"value\", function (d) { return d; }) \nself.dropdownButton = dropdownButton\nvar tooltip = d3.select(\"body\")\n    .append(\"div\")\n    .style(\"position\", \"absolute\")\n    .style(\"z-index\", \"100\")\n    .style(\"visibility\", \"hidden\")\nvar g4 = group1.append(\"g\").attr(\"id\",\"for_brush\"); //\n\nself.g4 = g4\nfunction dropchange(){\n  var newCereal = d3.select(this).property('value')\n  if (newCereal=='zoom'){\n    self.zoom_value = []\n    svg.call(zoom)\n     g4.style(\"display\",\"none\")\nself.svg.on(\"click\", function(){self.GLOBAL.Log_file.push(self.zoom_value[self.zoom_value.length - 1])\n    self.postInteraction({'name':self.GLOBAL.Log_file})})\n  self.myCircle.on(\"mouseover\", function(){return null})\n    .on(\"mousemove\", function(){return null})\n    .on(\"mouseout\", function(){return null})\n    d3.select(\"#map\")\n    .on('mouseover', function(){return null})\n  }\n  else if (newCereal=='select area'){\n    svg.on('.zoom', null)\n\n    g4.style(\"display\",\"block\")\n  g4\n    .call( d3.brush()                 // Add the brush feature using the d3.brush function\n      .extent( [ [0,0], [width,height] ] ) // initialise the brush area: start at 0,0 and finishes at width,height: it means I select the whole graph area\n      .on(\"end\", updata_chart)\n    )    \n  }\n  else if ((newCereal=='show point info'))\n    {svg.on('.zoom', null)\n  self.myCircle//.attr(\"fill\", function(d){return choose_color(d)})\n      .attr(\"opacity\",0.7)\n      .attr('r',4.8)\n      .attr('stroke',null)\n\n      g4.style(\"display\",\"none\")\n    /*\n    self.GLOBAL.Log_file.push(self.zoom_value[self.zoom_value.length - 1])\n    console.log(self.zoom_value[self.zoom_value.length - 1])\n    self.postInteraction({'name':self.GLOBAL.Log_file})\n    */\n\n      self.myCircle.on(\"click\", function(d){d3.select(this).attr(\"fill\",\"#BC8F8F\")\n      self.GLOBAL.New_time = new Date().getTime()/1000\n      if ((self.GLOBAL.New_time-self.GLOBAL.Old_time)>1){\n      self.GLOBAL.Visual_state['Map']['visit'].push(d),\n      Bus.$emit(\"change\", self.GLOBAL.Visual_state),\n      d3.select(\"#map\")\n  .on('click', function(){self.GLOBAL.Log_file.push(['timestamp',self.GLOBAL.New_time,'hover-map-position',d3.mouse(this),d.properties.name,'\\n']),self.postInteraction({'name':self.GLOBAL.Log_file}), self.GLOBAL.Old_time = self.GLOBAL.New_time})\n\n  }\n  return tooltip.style(\"visibility\", \"visible\").style(\"top\",(d3.event.pageY-10)+\"px\").style(\"left\",(d3.event.pageX+10)+\"px\").text(d.properties.name+','+d.properties.age+'岁')\n})\n    .on(\"mouseout\", function(){return tooltip.style(\"visibility\", \"hidden\"),d3.select(this).transition().duration(500).attr(\"fill\", function(d){return choose_color(d)});})\n    }\n}\n\n  function updata_chart(){\n    self.myCircle.attr(\"opacity\",0.7)\n    self.myLink.style(\"opacity\",0.4)\n    var select_data = update_data()\n  Bus.$emit(\"Map_select_data\", select_data)\n  }\n\n  function update_data() {\n    var select_data = []\n    var extent = d3.event.selection\n    self.myCircle.attr(\"fill\", function(d){return choose_color(d)})\n    self.myCircle.classed(\"selected_first\", function(d){ return isBrushed(extent, projection(d.geometry.coordinates)[0],projection(d.geometry.coordinates)[1]) }) \n    self.GLOBAL.New_time = new Date().getTime()/1000\n    if((self.GLOBAL.New_time-self.GLOBAL.Old_time)>1){\n    self.GLOBAL.Log_file.push(['timestamp',self.GLOBAL.New_time,'Brush-Map-Position',extent[0],extent[1],'\\n'])\n    self.postInteraction({'name':self.GLOBAL.Log_file})\n    self.GLOBAL.Old_time = self.GLOBAL.New_time\n    //console.log('r',self.GLOBAL.Get_message)\n    for(i=0, len=self.places.features.length-1; i<len; i++){\n      var d = self.places.features[i]\n      if(isBrushed(extent, projection(d.geometry.coordinates)[0],projection(d.geometry.coordinates)[1]))\n        {//a = a+parseInt(d.properties.age)}\n        select_data.push(d)}\n      }\n      return select_data\n      }\n\nfunction isBrushed(brush_coords, cx, cy) {\n       var x0 = brush_coords[0][0],\n           x1 = brush_coords[1][0],\n           y0 = brush_coords[0][1],\n           y1 = brush_coords[1][1];\n      return x0 <= cx && cx <= x1 && y0 <= cy && cy <= y1;    // This return TRUE or FALSE depending on if the points is in the selected area\n  }\n\n  }})},\nupdate(author){\nthis.g1_5.selectAll(\"*\").remove()\nthis.g2.selectAll(\"*\").remove()\nthis.g3.selectAll(\"*\").remove()\nthis.place_color_select = this.place_color[author]\n      //const width = 500;\n      //const height = 640;\nvar svg = this.svg\nvar projection = this.projection \nvar path = this.path\n//var dropdownButton = this. dropdownButton\nlet self = this\n      d3.json(\"map.json\", function(error, point) {\n      var places_all = topojson.feature(point, point.objects.places)\n\n      var places1 = []\n      for(i in places_all['features']){\n        if(places_all['features'][i].properties.author==author){\n          places1.push(places_all['features'][i])\n        }\n      }\n      var places = {type: \"FeatureCollection\",features:places1}\n      self.places = places\n      self.GLOBAL.place_now = places\n      \n  var myColor = d3.scaleSequential()\n    .domain([0.83,0.42])\n    .interpolator(d3Chromatic.interpolatePiYG);\n  function choose_color(place){\n    var name = place.properties.name\n    var res = \"rgb(100,149,237)\"\n    for (var i = 0;i<self.place_color_select.length; i++) {\n      var sli = self.place_color[author][i]\n      if(name == sli['place']){\n        res = myColor(sli['senti'])\n      }\n    }\n    return res\n  }\n\n      var g3 = self.g3\n      var g2 = self.g2\n\n// \nvar link1s = [\n  {type: \"LineString\", age:0,coordinates: [[0,0],[0,0]]}\n]\n    for(var i=0, len=places.features.length-1; i<len; i++){\n    // (note: loop until length - 1 since we're getting the next\n    //  item with i+1)\n        link1s.push({\n            type: \"LineString\",\n            age : places.features[i].properties.age,\n            coordinates: [\n                [ places.features[i].geometry.coordinates[0], places.features[i].geometry.coordinates[1]],\n                [ places.features[i+1].geometry.coordinates[0], places.features[i+1].geometry.coordinates[1]]]\n        });\n    }\n    g3.append('svg:defs').append('svg:marker')\n        .attr('id', 'end-arrow')\n        .attr('viewBox', '0 -5 8 8')\n        .attr('refX', 5)\n        .attr('markerWidth', 2.5)//箭头参数适当按需调整\n        .attr('markerHeight', 2.5)\n        .attr('orient', 'auto')\n        .append('svg:path')\n        .attr('d', 'M0,-5L10,0L0,5')//绘制箭头形状\n        .attr('fill', '#483D8B');\n  // 加label\n\n  self.myLink = g3.selectAll(\"myPath\")\n      .data(link1s)\n      .enter()\n      .append(\"path\")\n        .attr(\"d\", function(d){ return path(d)})\n        .style(\"fill\", \"none\")\n        .style(\"stroke\", \"#483D80\")\n        .style(\"stroke-width\", 2)\n        .style(\"opacity\",0.4)\n        .attr(\"marker-end\", \"url(#end-arrow)\")\n      g3.append(\"path\")\n        .attr(\"d\", d3.symbol().type(d3.symbolStar).size(200))\n        .attr(\"fill\",'red')\n        .attr(\"transform\",\"translate(297,166)\")\n  self.myCircle = g2.selectAll(\".place-point\")\n      .data(places.features)\n    .enter()\n    .append(\"circle\")\n      .attr(\"class\", \"place-point\")\n      .attr(\"transform\", function(d) { return \"translate(\" + projection(d.geometry.coordinates) + \")\"; })\n      .attr(\"x\", function(d) { return d.geometry.coordinates[0] > -1 ? 6 : -6; })\n      .attr(\"dy\", \".35em\")\n      .attr(\"r\", 4.8)//function(d) { return d.properties.age/10; })\n      .attr(\"fill\", function(d){return choose_color(d)})\n      .attr(\"opacity\",0.7)\n\n\n  self.svg = svg\n  var se = []\n  var vertices = []\nfor (i = 0, len = places.features.length; i < len; i++) {\n  var d = places.features[i]\n  se.push({'coordinates':projection(d.geometry.coordinates),'color':choose_color(d)})\n  vertices.push(projection(d.geometry.coordinates))\n}\nself.vertices = vertices\nself.GLOBAL.Visual_state['Map']['overall'] = se})\n\n/*\nvar allGroup = ['none',\"select area\", \"zoom\", \"show point info\"]\ndropdownButton.on(\"change\", dropchange)\n\n// add the options to the button\ndropdownButton // Add a button\n  .selectAll('myOptions') // Next 4 lines add 6 options = 6 colors\n  .data(allGroup)\n  .enter()\n  .append('option')\n  .text(function (d) { return d; }) // text showed in the menu\n  .attr(\"value\", function (d) { return d; }) \n\nvar tooltip = d3.select(\"body\")\n    .append(\"div\")\n    .style(\"position\", \"absolute\")\n    .style(\"z-index\", \"100\")\n    .style(\"visibility\", \"hidden\")\nvar g4 = self.g4\nself.g4 = g4\n\nfunction dropchange(){\n  var newCereal = d3.select(this).property('value')\n  if (newCereal=='zoom'){\n    self.zoom_value = []\n    svg.call(zoom)\n     g4.style(\"display\",\"none\")\nself.svg.on(\"click\", function(){self.GLOBAL.Log_file.push(self.zoom_value[self.zoom_value.length - 1])\n    console.log(self.zoom_value[self.zoom_value.length - 1])\n    self.postInteraction({'name':self.GLOBAL.Log_file})})\n  self.myCircle.on(\"mouseover\", function(){return null})\n    .on(\"mousemove\", function(){return null})\n    .on(\"mouseout\", function(){return null})\n    d3.select(\"#map\")\n    .on('mouseover', function(){return null})\n  }\n  else if (newCereal=='select area'){\n    svg.on('.zoom', null)\n    \n\n    g4.style(\"display\",\"block\")\n  g4\n    .call( d3.brush()                 // Add the brush feature using the d3.brush function\n      .extent( [ [0,0], [width,height] ] ) // initialise the brush area: start at 0,0 and finishes at width,height: it means I select the whole graph area\n      .on(\"end\", updata_chart)\n    )    \n  }\n  else if ((newCereal=='show point info'))\n    {svg.on('.zoom', null)\n      g4.style(\"display\",\"none\")\n    self.GLOBAL.Log_file.push(self.zoom_value[self.zoom_value.length - 1])\n    console.log(self.zoom_value[self.zoom_value.length - 1])\n    self.postInteraction({'name':self.GLOBAL.Log_file})\n\n\n      self.myCircle.on(\"click\", function(d){d3.select(this).attr(\"fill\",\"#BC8F8F\")\n      self.GLOBAL.New_time = new Date().getTime()/1000\n      if ((self.GLOBAL.New_time-self.GLOBAL.Old_time)>1){\n      self.GLOBAL.Visual_state['Map']['visit'].push(d),\n      Bus.$emit(\"change\", self.GLOBAL.Visual_state),\n      d3.select(\"#map\")\n  .on('click', function(){self.GLOBAL.Log_file.push(['timestamp',self.GLOBAL.New_time,'hover-map-position',d3.mouse(this),d.properties.name,'\\n']),self.postInteraction({'name':self.GLOBAL.Log_file}), self.GLOBAL.Old_time = self.GLOBAL.New_time})\n\n  }\n  return tooltip.style(\"visibility\", \"visible\").style(\"top\",(d3.event.pageY-10)+\"px\").style(\"left\",(d3.event.pageX+10)+\"px\").text(d.properties.name+','+d.properties.age+'岁')\n})\n    .on(\"mouseout\", function(){return tooltip.style(\"visibility\", \"hidden\"),d3.select(this).transition().duration(500).attr(\"fill\", function(d){return choose_color(d)});})\n    }\n}\n\n  function updata_chart(){\n    self.myCircle.attr(\"opacity\",0.7)\n    self.myLink.style(\"opacity\",0.4)\n    var select_data = update_data()\n  Bus.$emit(\"Map_select_data\", select_data)\n  }\n\n  function update_data() {\n    var select_data = []\n    var extent = d3.event.selection\n    self.myCircle.attr(\"fill\", function(d){return choose_color(d)})\n    self.myCircle.classed(\"selected_first\", function(d){ return isBrushed(extent, projection(d.geometry.coordinates)[0],projection(d.geometry.coordinates)[1]) }) \n    self.GLOBAL.New_time = new Date().getTime()/1000\n    if((self.GLOBAL.New_time-self.GLOBAL.Old_time)>1){\n    self.GLOBAL.Log_file.push(['timestamp',self.GLOBAL.New_time,'Brush-Map-Position',extent[0],extent[1],'\\n'])\n    self.postInteraction({'name':self.GLOBAL.Log_file})\n    self.GLOBAL.Old_time = self.GLOBAL.New_time\n    //console.log('r',self.GLOBAL.Get_message)\n    for(i=0, len=places.features.length-1; i<len; i++){\n      var d = places.features[i]\n      if(isBrushed(extent, projection(d.geometry.coordinates)[0],projection(d.geometry.coordinates)[1]))\n        {//a = a+parseInt(d.properties.age)}\n        select_data.push(d)}\n      }\n      return select_data\n      }\n\nfunction isBrushed(brush_coords, cx, cy) {\n       var x0 = brush_coords[0][0],\n           x1 = brush_coords[1][0],\n           y0 = brush_coords[0][1],\n           y1 = brush_coords[1][1];\n      return x0 <= cx && cx <= x1 && y0 <= cy && cy <= y1;    // This return TRUE or FALSE depending on if the points is in the selected area\n  }\n\n  }})\n*/},\n\nselect_new_point(){\n    var data = this.Hist_select_data\n    this.myCircle.classed(\"selected_second\", function(d){return isSelectedByHist(d,data)})\n    //this.myLink.style(\"stroke\",function(d) {return LinkisSelectedByHist(d)})\n    //this.myLink.style(\"opacity\",function(d) {return LinkisSelectedByHist_O(d)})\n    //this.myLink.style(\"stroke-width\",function(d) {return LinkisSelectedByHist_S(d)})\n    \nfunction isSelectedByHist(a,data){\n  for(var i=0,len=data.length;i<len;i++){\n    var geo = data[i].properties.name\n    var age_select = data[i].properties.age\n    if (a.properties.name==geo){\n      if(a.properties.age==age_select){\n        return (1==1)\n      }}}\n  return (1==0)}\n},\nselect_new_point_Force(){\n  var data = this.Force_select_data\n  this.myCircle.classed(\"selected_second\", function(d){return d.properties.name==data})\n},\nshow_period(){\n  this.g4.style(\"display\",\"none\")\n  let self = this\n  var myColor = d3.scaleSequential()\n    .domain([0.83,0.42])\n    .interpolator(d3Chromatic.interpolatePiYG);\n  function choose_color(place){\n    var name = place.properties.name\n    var res = \"rgb(100,149,237)\"\n    for (var i = 0;i<self.place_color_select.length; i++) {\n      var sli = self.place_color_select[i]\n      if(name == sli['place']){\n        res = myColor(sli['senti'])\n      }\n    }\n    return res\n  }\n\n  function choose_id(place){\n    var name = place.properties.name\n    var res = 5\n    for (var i = 0;i<self.place_color_select.length; i++) {\n      var sli = self.place_color_select[i]\n      if(name == sli['place']){\n        var senti = sli['senti']\n        if(senti<0.502){\n          res = 0\n        }\n        else if ((senti>0.502)&(senti<0.584)){res = 1}\n        else if ((senti>0.584)&(senti<0.666)){res = 2}\n        else if ((senti>0.666)&(senti<0.748)){res = 3}\n        else if ((senti>0.748)){res = 4}\n      }\n    }\n    return res\n  }\n  this.myCircle.attr(\"fill\", function(d){return choose_color(d)})\n  this.myCircle.attr(\"opacity\",function(d){\n    var id = choose_id(d)\n    if(self.hover_period==6){\n       return 0.7\n    }\n    if(id==self.hover_period){\n      return 1\n    }\n    else{return 0}\n  })\n  this.myLink.style(\"opacity\",function(){\n    if(self.hover_period==6){ return 0.4}\n    else{return 0}\n  })},\nGet_Predict(predict_all){\n  console.log('Map_Get_Predict')\n  this.g1_5.selectAll(\"*\").remove()\n  for(var i in predict_all){\n    var predict = predict_all[i]\n    var position = predict['Behavior']\n    console.log('position',position)\n  if (predict['type']=='Brush'){\n    var x_1 = Math.min(Math.max(0,position['x_position1']),500)\n    var y_1 = Math.min(Math.max(0,position['y_position1']),650)\n    var x_2 = Math.min(Math.max(x_1+20,position['x_position2']),500)\n    var y_2 = Math.min(Math.max(y_1+20,position['y_position2']),650)\n\n    this.g1_5.append('rect')\n  .attr('x', x_1)\n  .attr('y', y_1)\n  .attr('width', x_2-x_1)\n  .attr('height', y_2-y_1)\n  .attr('stroke', 'black')\n  .attr('stroke-width',\"1px\")\n  .attr(\"opacity\",0.5)\n  .attr('fill', '#69a3b2');\n\n      this.g1_5.append('text')\n  .attr('x', x_1)\n  .attr('y', y_1)\n  .text('Brush')\n  .attr('stroke', 'black')\n  .attr('stroke-width',\"1px\")\n  .style(\"font-size\",\"14px\");\n  }\n  \n  if (predict['type']=='Zoom'){\n    var scale = position['scale']\n    var delta_x = position['delta_x']\n    var delta_y = position['delta_y']\n    var width_rec = 500/scale\n    var height_rec = 640/scale\n    var x1 = Math.max(0,-delta_x)\n    var y1 = Math.max(0,-delta_y)\n        this.g1_5.append('rect')\n  .attr('x', x1)\n  .attr('y', y1)\n  .attr('width', width_rec)\n  .attr('height', height_rec)\n  .attr('stroke', 'black')\n  .attr('stroke-width',\"1px\")\n  .attr(\"opacity\",0.1)\n  .attr('fill', '#69a3b2');\n\n      this.g1_5.append('text')\n  .attr('x', x1)\n  .attr('y', y1)\n  .text('Zoom')\n  .attr('stroke', 'black')\n  .attr('stroke-width',\"2px\")\n  .style(\"font-size\",\"14px\");\n  }\n  \n  if (predict['type']=='Click'){\n    if(predict['Object_View']=='Map'){\n    var x_position = position['x_position']\n    var y_position = position['y_position']\n    var dist = 0\n    var min_dist = Number.POSITIVE_INFINITY\n    var diss = 0\n    for(i in this.vertices){\n      var d = this.vertices[i]\n      dist = (x_position-d[0])**2+(y_position-d[1])**2\n      if (dist<min_dist){\n        diss = d\n        min_dist = dist\n      }\n    }\n    this.g1_5.append('circle')\n  .attr('cx', diss[0])\n  .attr('cy', diss[1])\n  .attr('r', 7)\n  .attr('stroke', 'black')\n  .attr(\"stroke-width\",'4px')\n  .attr(\"opacity\",1)\n  .attr('fill', '#69a3b2');}}\n  }\n\n\n}\n\n}}\n</script>\n<style>\n\n.selected_first {\n  stroke: black;\n  stroke-width: 1px;\n}\n.selected_second {\n  opacity: 1;\n  stroke: black;\n  stroke-width: 3px;\n  fill: orange;\n  r:6px;\n}\n.subunit.SCT { fill: #ddc; }\n.subunit.WLS { fill: #cdd; }\n.subunit.NIR { fill: #cdc; }\n.subunit.ENG { fill: #dcd; }\n\n.subunit.IRL,\n.subunit-label.IRL {\n  display: none;\n}\n\n.subunit-boundary {\n  fill: none;\n  stroke: #777;\n  stroke-dasharray: 2,2;\n  stroke-linejoin: round;\n}\n\n.subunit-boundary.IRL {\n  stroke: #aaa;\n}\n\n.subunit-label {\n  fill: #777;\n  fill-opacity: .5;\n  font-size: 20px;\n  font-weight: 300;\n  text-anchor: middle;\n}\n.place-point\n.place\n.place-label {\n  fill: #444;\n}\n\ntext {\n  font-family: \"Helvetica Neue\", Helvetica, Arial, sans-serif;\n  font-size: 10px;\n  pointer-events: none;\n}\n#label {\n  position: absolute;\n  left: 10px;\n  font-weight: 100;\n  font-family: \"Proxima Nova\", \"Montserrat\", sans-serif;\n}\n\n.hover {\n    fill: yellow;   \n}\n.desplegable {\n        left: 10px;\n        top: 5px;\n    }\n/*\n#sliderContainer {\n    text-align: center;\n    top: 600px;\n    left:10px;\n}\n#histplot{\n    text-align: center;\n    top: 600px;\n    left:10px;\n}\n#map {\n    top: 2000px;\n    left:1000px;\n}\n*/\n</style>"]}]}